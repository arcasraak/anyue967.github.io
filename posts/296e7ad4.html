<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="CgwFJwXKXv">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"anyue967.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":"motion","async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="2019-06-11-Linux服务配置01">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux服务配置01">
<meta property="og:url" content="https://anyue967.github.io/posts/296e7ad4.html">
<meta property="og:site_name" content="旅行">
<meta property="og:description" content="2019-06-11-Linux服务配置01">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/jiegou.jpg">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/RAID0.png">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/raid1.jpg">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/raid5.jpg">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/raid-10.png">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/%E9%80%BB%E8%BE%91%E5%8D%B7.png">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/SNAT.png">
<meta property="og:image" content="https://anyue967.github.io/posts/296e7ad4/DNAT.png">
<meta property="article:published_time" content="2019-06-11T01:10:30.000Z">
<meta property="article:modified_time" content="2020-09-14T10:03:48.505Z">
<meta property="article:author" content="anyue967">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="Devops">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://anyue967.github.io/posts/296e7ad4/jiegou.jpg">

<link rel="canonical" href="https://anyue967.github.io/posts/296e7ad4.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Linux服务配置01 | 旅行</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="旅行" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">旅行</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The end of the world</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">41</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">27</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">43</span></a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/anyue967" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyue967.github.io/posts/296e7ad4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="anyue967">
      <meta itemprop="description" content="Just for one truth">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旅行">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux服务配置01
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-11 09:10:30" itemprop="dateCreated datePublished" datetime="2019-06-11T09:10:30+08:00">2019-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-14 18:03:48" itemprop="dateModified" datetime="2020-09-14T18:03:48+08:00">2020-09-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Devops-linux/" itemprop="url" rel="index"><span itemprop="name">Devops, linux</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
              <span>℃</span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/posts/296e7ad4.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/posts/296e7ad4.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>38k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>35 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>2019-06-11-Linux服务配置01</p>
<a id="more"></a>

<h2 id="目录"><a href="#目录" class="headerlink" title="目录    "></a>目录    <a id="back"></a></h2><ul>
<li><a href="#fdisk" target="_self">分区/格式化/挂载/卸载</a></li>
<li><a href="#uquota" target="_self">磁盘容量配额技术 uquota</a></li>
<li><a href="#raid" target="_self">RAID 磁盘阵列</a></li>
<li><a href="#lvm" target="_self">LVM 逻辑卷管理</a></li>
<li><a href="#iptables" target="_self">iptables 参数 规则链 动作</a></li>
<li><a href="#firewalld" target="_self">firewall-cmd 防火墙</a></li>
<li><a href="#ssh" target="_self">SSH 服务</a></li>
<li><a href="#scp" target="_self">scp 远程传输</a></li>
<li><a href="#apache" target="_self">apache 服务</a></li>
</ul>
<h3 id="1-一切从-开始"><a href="#1-一切从-开始" class="headerlink" title="1. 一切从  / 开始"></a>1. 一切从  / 开始</h3><img src="/posts/296e7ad4/jiegou.jpg" class title="[文件系统与目录结构]">  

<table>
<thead>
<tr>
<th>类别</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>/boot</td>
<td>开机所需文件——内核、开机菜单以及所需配置文件</td>
</tr>
<tr>
<td>/dev</td>
<td>以文件形式存放任何设备及接口</td>
</tr>
<tr>
<td>/etc</td>
<td>配置文件</td>
</tr>
<tr>
<td>/home</td>
<td>用户家目录</td>
</tr>
<tr>
<td>/bin</td>
<td>存放单用户模式下还可以操作的命令</td>
</tr>
<tr>
<td>/lib</td>
<td>开机时用到的函数库</td>
</tr>
<tr>
<td>/sbin</td>
<td>开机过程中用到的命令</td>
</tr>
<tr>
<td>/media</td>
<td>挂载设备文件的目录</td>
</tr>
<tr>
<td>/opt</td>
<td>第三方软件</td>
</tr>
<tr>
<td>/root</td>
<td>系统管理员家目录</td>
</tr>
<tr>
<td>/srv</td>
<td>网络服务的数据文件目录</td>
</tr>
<tr>
<td>/tmp</td>
<td>任何人均可使用的“共享”临时目录</td>
</tr>
<tr>
<td>/proc</td>
<td>虚拟文件系统</td>
</tr>
<tr>
<td>/usr/local</td>
<td>用户自行安装的软件</td>
</tr>
<tr>
<td>/usr/sbin</td>
<td>开机不会使用的软件及脚本</td>
</tr>
<tr>
<td>/usr/share</td>
<td>帮助与说明文件</td>
</tr>
<tr>
<td>/var</td>
<td>经常变化文件,日志</td>
</tr>
<tr>
<td>/lost+found</td>
<td>当文件系统发生错误，存放丢失的文件片段</td>
</tr>
</tbody></table>
<h3 id="2-路径"><a href="#2-路径" class="headerlink" title="2. 路径"></a>2. 路径</h3><p>绝对路径：从根目录(/)开始写起的文件或目录<br>相对路径：相对于当前路径的写法  <code>./  ../  ~</code></p>
<h3 id="3-物理设备的命名规则"><a href="#3-物理设备的命名规则" class="headerlink" title="3. 物理设备的命名规则"></a>3. 物理设备的命名规则</h3><table>
<thead>
<tr>
<th>类别</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>IDE</td>
<td>/dev/hd[a-d]</td>
</tr>
<tr>
<td>SCSI/SATA/U盘</td>
<td>/dev/sd[a-p]</td>
</tr>
<tr>
<td>软驱</td>
<td>/dev/fd[0-1]</td>
</tr>
<tr>
<td>打印机</td>
<td>/dev/lp[0-15]</td>
</tr>
<tr>
<td>光驱</td>
<td>/dev/cdrom</td>
</tr>
<tr>
<td>鼠标</td>
<td>/dev/mouse</td>
</tr>
<tr>
<td>磁带机</td>
<td>/dev/st0   /dev/ht0</td>
</tr>
</tbody></table>
<ul>
<li><strong>主分区/扩展分区编号从1开始，到4结束　逻辑分区从编号5开始</strong><br>硬盘设备是由大量扇区组成的，<strong>每个扇区的容量为512字节</strong>，第一个扇区最重要，保存了<strong>主引导记录与分区表信息MBR</strong>，主引导记录用446B，分区表用64B，结束符用2B；分区表记录一个<strong>分区信息需要16B</strong>，最多只有4个分区信息可以写到第一个扇区中，这四个分区就是4个主分区；</li>
<li>为了解决分区个数不够,可以将第一个扇区分区表中16B(原本写入主分区信息)的空间(称为扩展分区)拿出来指向另外一个分区表。<strong>扩展分区不是一个真正的分区</strong>,是一个占用16字节分区表空间的指针。所以,<strong>用户一般会选择3个主分区加1个扩展分区,在扩展分区中建立数个逻辑分区</strong>；</li>
</ul>
<h3 id="4-文件系统与数据资料"><a href="#4-文件系统与数据资料" class="headerlink" title="4. 文件系统与数据资料"></a>4. 文件系统与数据资料</h3><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>EXT3</td>
<td>日志文件系统</td>
</tr>
<tr>
<td>Ext4</td>
<td>Ext3改进版,RHEL6系统默认文件管理系统,支持存储容量高达1EB</td>
</tr>
<tr>
<td>XFS</td>
<td>高性能的日志文件系统,RHEL7默认文件管理系统,最大支持存储容量18EB</td>
</tr>
</tbody></table>
<h3 id="5-挂载硬件设备"><a href="#5-挂载硬件设备" class="headerlink" title="5. 挂载硬件设备"></a>5. 挂载硬件设备</h3><p><strong>注：</strong> mount -a 会自动检查/etc/fstab文件有无疏漏的挂载设备，若有则自动进行挂载</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-t</td>
<td>指定文件的系统类型:iso9600</td>
</tr>
<tr>
<td>-o</td>
<td>描述设备或档案的挂载方式</td>
</tr>
<tr>
<td>—</td>
<td>loop:把文件当成硬盘分区挂载</td>
</tr>
<tr>
<td>—</td>
<td>ro:只读方式</td>
</tr>
<tr>
<td>—</td>
<td>rw:读写方式</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mount /dev/sdb2 /backup # 挂载目录需要挂载前创建好，mount[设备文件 挂在目录]  </span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/fstab	     # 开机自动挂载sdb2    </span></span><br><span class="line">  1  <span class="comment">#  </span></span><br><span class="line">  2  <span class="comment"># /etc/fstab  </span></span><br><span class="line">  3  <span class="comment"># Created by anaconda on Fri Jul  6 08:44:38 2018  </span></span><br><span class="line">  4  <span class="comment">#  </span></span><br><span class="line">  5  <span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;  </span></span><br><span class="line">  6  <span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info  </span></span><br><span class="line">  7  <span class="comment">#  </span></span><br><span class="line">  8  /dev/mapper/rhel-root                      /         xfs       defaults        1 1  </span><br><span class="line">  9  UUID=28d7b2f5-a322-4990-ab6c-5936d156fce7 /boot      xfs       defaults        1 2  </span><br><span class="line">  10 /dev/mapper                              /rhel-swap  swap swap defaults        0 0  </span><br><span class="line">  11 /dev/cdrom                              /media/cdrom iso9660   defaults        0 0  </span><br><span class="line">  12 /dev/sdb2							  /backup		ext4      defaults        0 0  </span><br></pre></td></tr></table></figure>

<h3 id="6-撤销挂载设备"><a href="#6-撤销挂载设备" class="headerlink" title="6. 撤销挂载设备  "></a>6. 撤销挂载设备  <a id="fdisk"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]# umount &#x2F;dev&#x2F;sdb2　# umount [设备文件&#x2F;挂在目录]</span><br></pre></td></tr></table></figure>

<h3 id="7-分区-格式化-挂载"><a href="#7-分区-格式化-挂载" class="headerlink" title="7. 分区-格式化-挂载:"></a>7. 分区-格式化-挂载:</h3><h4 id="fdisk"><a href="#fdisk" class="headerlink" title="fdisk"></a>fdisk</h4><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-m</td>
<td>查看全部可用参数</td>
</tr>
<tr>
<td>-n</td>
<td>添加新的分区，p主分区，e扩展分区</td>
</tr>
<tr>
<td>-d</td>
<td>删除某个分区信息</td>
</tr>
<tr>
<td>-q</td>
<td>不保存退出</td>
</tr>
<tr>
<td>-l</td>
<td>✔列出所以可用的分区类型</td>
</tr>
<tr>
<td>-t</td>
<td>✔改变某个分区的信息</td>
</tr>
<tr>
<td>-p</td>
<td>✔查看分区信息</td>
</tr>
<tr>
<td>-w</td>
<td>保存并退出</td>
</tr>
</tbody></table>
<h4 id="7-1-分区："><a href="#7-1-分区：" class="headerlink" title="7.1 分区："></a>7.1 分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># fdisk /dev/sdb  # sd --&gt;SATA</span></span><br><span class="line">  Welcome to fdisk (util-linux 2.23.2).  </span><br><span class="line"></span><br><span class="line">  Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.  </span><br><span class="line">  Be careful before using the write <span class="built_in">command</span>.  </span><br><span class="line"></span><br><span class="line">  Device does not contain a recognized partition table  </span><br><span class="line">  Building a new DOS disklabel with disk identifier 0x301a431a.  </span><br><span class="line">   </span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p 	<span class="comment">#查看分区信息  </span></span><br><span class="line">  Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors  </span><br><span class="line">  Units = sectors of 1 * 512 = 512 bytes  </span><br><span class="line">  Sector size (logical/physical): 512 bytes / 512 bytes  </span><br><span class="line">  I/O size (minimum/optimal): 512 bytes / 512 bytes  </span><br><span class="line">  Disk label <span class="built_in">type</span>: dos  </span><br><span class="line">  Disk identifier: 0x301a431a  </span><br><span class="line">  </span><br><span class="line">  Device Boot      Start         End      Blocks   Id  System  </span><br><span class="line"> </span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n 	<span class="comment">#添加新的分区  </span></span><br><span class="line">  Partition <span class="built_in">type</span>:  </span><br><span class="line">      p   primary (0 primary, 0 extended, 4 free)  </span><br><span class="line">      e   extended  </span><br><span class="line">  </span><br><span class="line">Select (default p): p   </span><br><span class="line">Partition number (1-4, default 1): 1  </span><br><span class="line">  First sector (2048-41943039, default 2048):   </span><br><span class="line">  Using default value 2048  </span><br><span class="line">  Last sector, +sectors or +size&#123;K,M,G&#125; (2048-41943039, default 41943039): +2G <span class="comment"># 创建2GB分区  </span></span><br><span class="line">  Partition 1 of <span class="built_in">type</span> Linux and of size 2 GiB is <span class="built_in">set</span>  </span><br><span class="line">  </span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p 		　<span class="comment"># 查看分区信息     </span></span><br><span class="line">  Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors  </span><br><span class="line">  Units = sectors of 1 * 512 = 512 bytes  </span><br><span class="line">  Sector size (logical/physical): 512 bytes / 512 bytes  </span><br><span class="line">  I/O size (minimum/optimal): 512 bytes / 512 bytes  </span><br><span class="line">  Disk label <span class="built_in">type</span>: dos  </span><br><span class="line">  Disk identifier: 0x301a431a  </span><br><span class="line"></span><br><span class="line">  Device Boot      Start         End      Blocks   Id  System  </span><br><span class="line">  /dev/sdb1            2048     4196351     2097152   83  Linux  </span><br><span class="line">  </span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w 	<span class="comment"># 保存分区信息并退出</span></span><br><span class="line">  The partition table has been altered!  </span><br><span class="line">  Calling ioctl() to re-read partition table.  </span><br><span class="line">  Syncing disks.</span><br><span class="line">   </span><br><span class="line">[root@xy ~]<span class="comment"># file /dev/sdb　# file 查看 /dev/sdb1 文件属性  /dev/sdb1: cannot open (No such file or directory)</span></span><br><span class="line">[root@xy ~]<span class="comment"># partprobe　#partprobe 同步分区信息到系统内核 </span></span><br><span class="line">[root@xy ~]<span class="comment"># file /dev/sdb1  </span></span><br><span class="line">/dev/sdb1: block special  </span><br></pre></td></tr></table></figure>

<h4 id="7-2-格式化-创建文件系统类型-：-mkfs-文件类型名称-dev-sdb1"><a href="#7-2-格式化-创建文件系统类型-：-mkfs-文件类型名称-dev-sdb1" class="headerlink" title="7.2 格式化(创建文件系统类型)： mkfs.文件类型名称 /dev/sdb1"></a>7.2 格式化(创建文件系统类型)： mkfs.文件类型名称 /dev/sdb1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkfs # 分区完后用 mkfs 格式化  </span></span><br><span class="line">    mkfs	 mkfs.cramfs  	mkfs.ext3	mkfs.fat	mkfs.msdos  	</span><br><span class="line">    mkfs.xfs	mkfs.btrfs	mkfs.ext2	mkfs.ext4	mkfs.minix   </span><br><span class="line">    mkfs.vfat   </span><br><span class="line">[root@xy ~]<span class="comment"># mkfs -t xfs /dev/sdb1 </span></span><br><span class="line">  meta-data=/dev/sdb1  isize=256  agcount=4, agsize=131072 blks  </span><br><span class="line">  =  sectsz=512  attr=2, projid32bit=1  </span><br><span class="line">  =  crc=0  </span><br><span class="line">  data  =bsize=4096   blocks=524288, imaxpct=25  </span><br><span class="line">  =  sunit=0  swidth=0 blks  </span><br><span class="line">  naming  =version 2  bsize=4096   ascii-ci=0 ftype=0  </span><br><span class="line">  <span class="built_in">log</span>  =internal <span class="built_in">log</span>  bsize=4096   blocks=2560, version=2  </span><br><span class="line">  =  sectsz=512   sunit=0 blks, lazy-count=1  </span><br><span class="line">  realtime =none  extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>

<h4 id="7-3-挂载分区："><a href="#7-3-挂载分区：" class="headerlink" title="7.3 挂载分区："></a>7.3 挂载分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkdir /newFS</span></span><br><span class="line">[root@xy ~]<span class="comment"># mount /dev/sdb1 /newFS/  </span></span><br><span class="line">[root@xy ~]<span class="comment"># df -h 	　 # 查看挂载状态及设备 建议 df -Th 命令信息更全 </span></span><br><span class="line">    Filesystem           Size  Used Avail Use% Mounted on  </span><br><span class="line">    /dev/mapper/rhel-root   28G  3.0G   25G  11% /  </span><br><span class="line">    devtmpfs               985M     0  985M   0% /dev  </span><br><span class="line">    tmpfs                  994M  148K  994M   1% /dev/shm  </span><br><span class="line">    tmpfs                  994M  8.8M  986M   1% /run  </span><br><span class="line">    tmpfs                  994M     0  994M   0% /sys/fs/cgroup  </span><br><span class="line">    /dev/sr0               3.5G  3.5G     0 100% /media/cdrom  </span><br><span class="line">    /dev/sda1              497M  119M  379M  24% /boot  </span><br><span class="line">    /dev/sdb1              2.0G   33M  2.0G   2% /newFS  </span><br><span class="line">    </span><br><span class="line">[root@xy ~]<span class="comment"># cp -rf /etc/* /newFS</span></span><br><span class="line">[root@xy ~]<span class="comment"># ls /newFS</span></span><br><span class="line">abrt hosts pulse  </span><br><span class="line">adjtime host.allow purple  </span><br><span class="line">........省略部分信息........  </span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># du -sh /newFS/ 　 # du -sh  查看空间占用情况  </span></span><br><span class="line">33M /newFS/</span><br></pre></td></tr></table></figure>

<h3 id="8-添加交换分区swap"><a href="#8-添加交换分区swap" class="headerlink" title="8. 添加交换分区swap"></a>8. 添加交换分区swap</h3><blockquote>
<p>交换分区是把内存中暂时不用的数据临时存放到硬盘中,解决物理内存不足问题,交换分区一般为物理内存的1.5~2倍  ，mkswap 与 swapon  </p>
</blockquote>
<h4 id="8-1-分区："><a href="#8-1-分区：" class="headerlink" title="8.1 分区："></a>8.1 分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># fdisk /dev/sdb 　 # 分区  </span></span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).  </span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.  </span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.  </span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line"> Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)  </span><br><span class="line">   e   extended  </span><br><span class="line"></span><br><span class="line">Select (default p): p </span><br><span class="line"> Partition number (2-4, default 2): 2  </span><br><span class="line">  First sector (4196352-41943039, default 4196352):   </span><br><span class="line">  Using default value 4196352  </span><br><span class="line">  Last sector, +sectors or +size&#123;K,M,G&#125; (4196352-41943039, default 41943039): +5G  </span><br><span class="line">  Partition 2 of <span class="built_in">type</span> Linux and of size 5 GiB is <span class="built_in">set</span>  </span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p  </span><br><span class="line"> Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors  </span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes  </span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes  </span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes  </span><br><span class="line">Disk label <span class="built_in">type</span>: dos  </span><br><span class="line">Disk identifier: 0x301a431a  </span><br><span class="line"></span><br><span class="line"> Device Boot      Start         End      Blocks   Id  System  </span><br><span class="line">/dev/sdb1            2048     4196351     2097152   83  Linux  </span><br><span class="line">/dev/sdb2         4196352    14682111     5242880   83  Linux  </span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w  </span><br><span class="line"> The partition table has been altered!  </span><br><span class="line"></span><br><span class="line"> Calling ioctl() to re-read partition table.  </span><br><span class="line"></span><br><span class="line"> WARNING: Re-reading the partition table failed with error 16: Device or resource busy.  </span><br><span class="line">The kernel still uses the old table. The new table will be used at  </span><br><span class="line">the next reboot or after you run partprobe(8) or kpartx(8)  </span><br><span class="line">Syncing disks.  </span><br></pre></td></tr></table></figure>

<h4 id="8-2-格式化："><a href="#8-2-格式化：" class="headerlink" title="8.2 格式化："></a>8.2 格式化：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkswap /dev/sdb2  　# 格式化 mkswap  </span></span><br><span class="line">/dev/sdb2: No such file or directory  </span><br><span class="line">[root@xy ~]<span class="comment"># partprobe  </span></span><br><span class="line">[root@xy ~]<span class="comment"># partprobe  </span></span><br><span class="line">[root@xy ~]<span class="comment"># mkswap /dev/sdb2  </span></span><br><span class="line">Setting up swapspace version 1, size = 5242876 KiB  </span><br><span class="line">no label, UUID=ffe8494a-c2f5-4af4-becf-985b130d395c  </span><br><span class="line">[root@xy ~]<span class="comment"># free -m  </span></span><br><span class="line">             total       used       free     shared    buffers     cached  </span><br><span class="line">Mem:          1987       1137        850          9          1        279  </span><br><span class="line">-/+ buffers/cache:        856       1131  </span><br><span class="line">Swap:            0          0          0  </span><br></pre></td></tr></table></figure>

<h4 id="8-3-挂载分区："><a href="#8-3-挂载分区：" class="headerlink" title="8.3 挂载分区："></a>8.3 挂载分区：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># swapon /dev/sdb2    　# 挂载使用  </span></span><br><span class="line">[root@xy ~]<span class="comment"># free -m  </span></span><br><span class="line">             total       used       free     shared    buffers     cached  </span><br><span class="line">Mem:          1987       1141        846          9          1        279  </span><br><span class="line">-/+ buffers/cache:        860       1127  </span><br><span class="line">Swap:         5119          0       5119  </span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/fstab 　# 设置自动挂载      </span></span><br><span class="line">  1  <span class="comment">#  </span></span><br><span class="line">  2  <span class="comment"># /etc/fstab  </span></span><br><span class="line">  3  <span class="comment"># Created by anaconda on Fri Jul  6 08:44:38 2018  </span></span><br><span class="line">  4  <span class="comment">#  </span></span><br><span class="line">  5  <span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;  </span></span><br><span class="line">  6  <span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info  </span></span><br><span class="line">  7  <span class="comment">#  </span></span><br><span class="line">  /dev/mapper/rhel-root                  /         xfs       defaults        1 1    </span><br><span class="line">  UUID=28d7b2f5-a322-4990-ab6c-5936d156fce7 /boot  xfs       defaults        1 2    </span><br><span class="line">  /dev/mapper                          /rhel-swap  swap swap defaults        0 0  </span><br><span class="line">  /dev/cdrom                          /media/cdrom iso9660   defaults        0 0    </span><br><span class="line">  /dev/sdb1                          /newFS        xfs       defaults        0 0    </span><br><span class="line">  /dev/sdb2                          swap          swap      defaults        0 0 </span><br></pre></td></tr></table></figure>

<h3 id="9-删除手动增加的交换分区swap"><a href="#9-删除手动增加的交换分区swap" class="headerlink" title="9. 删除手动增加的交换分区swap"></a>9. 删除手动增加的交换分区swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># /sbin/swapoff /dev/sdb2  </span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/fstab   </span></span><br><span class="line">/dev/sdb2    swap     swap     defaults       0 0 　<span class="comment"># 删除  </span></span><br><span class="line">[root@xy ~]<span class="comment"># swapon -s</span></span><br><span class="line">Filename        Type      Size    Used  Priority  </span><br><span class="line">/dev/dm-0       partition 2113532 0     -1  </span><br></pre></td></tr></table></figure>

<h3 id="10-磁盘容量配额技术"><a href="#10-磁盘容量配额技术" class="headerlink" title="10. 磁盘容量配额技术  "></a>10. 磁盘容量配额技术  <a id="uquota"></a></h3><p><strong>配置/etc/fstab,使/boot目录支持uquota,磁盘容量配额技术</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID=28d7b2f5-a322-4990-ab6c-5936d156fce7 /boot    xfs    defaults,uquota 1 2</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># reboot  </span></span><br><span class="line">[root@xy ~]<span class="comment"># mount | grep boot</span></span><br><span class="line">/dev/sda1 on /boot <span class="built_in">type</span> xfs (rw,relatime,seclablel,attr2,inode64,usrquota)  </span><br><span class="line">[root@xy ~]<span class="comment"># useradd tom   </span></span><br><span class="line">[root@xy ~]<span class="comment"># chmod -Rf o+w /boot 　# other write  </span></span><br><span class="line">[root@xy ~]<span class="comment"># xfs_quota -x -c &#x27;limit bsoft=3m bhard=6m isoft=3 ihard=6 tom&#x27; /boot</span></span><br><span class="line">[root@xy ~]<span class="comment"># xfs_quota -x -c report /boot　# xfs_quota -x -c</span></span><br><span class="line">  User quota on /boot (/dev/sda1)	  Blocks  </span><br><span class="line">  User ID Used Soft Hard Warn/Grace  </span><br><span class="line">  ----------- ----------------------------------------------  </span><br><span class="line">  root 95084   0     0    00 [--------] </span><br><span class="line">  tom  0       3072  6144 00 [--------] </span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># su - tom  </span></span><br><span class="line">[tom@xy ~]$ dd <span class="keyword">if</span>=/dev/zero of=/boot/tom bs=5M count=1  </span><br><span class="line">  1+0 records <span class="keyword">in</span>  </span><br><span class="line">  1+0 records out  </span><br><span class="line">  5242880 bytes (5.2 MB) copied, 0.123996 s, 42.3 MB/s  </span><br><span class="line"></span><br><span class="line">[tom@xy ~]$ dd <span class="keyword">if</span>=/dev/zero of=/boot/tom bs=8M count=1</span><br><span class="line">  dd: error writing <span class="string">&#x27;/boot/tom&#x27;</span>: Disk quato exceeded 　 <span class="comment"># 限制  </span></span><br><span class="line">  1+0 records <span class="keyword">in</span>  </span><br><span class="line">  1+0 records out  </span><br><span class="line">  6291456 bytes (6.3 MB) copied, 0.0201596s, 312MB/s  </span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># edquota -u tom　 # edquota -u 按需修改配额    </span></span><br><span class="line">  Disk quotas <span class="keyword">for</span> user tom (uid 1001):  </span><br><span class="line">  Filesystem blocks   soft   hard   inodes   soft   hard  </span><br><span class="line">  /dev/sda   6114     3072   8192   1        3      6  </span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># su - tom</span></span><br><span class="line">[tom@xy ~]$ dd <span class="keyword">if</span>=/dev/zero of=/boot/tom bs=8M count=1  </span><br><span class="line">  1+0 records <span class="keyword">in</span>  </span><br><span class="line">  1+0 records out  </span><br><span class="line">  8388608 bytes (8.4 MB) copied, 0.0238044s, 313MB/s  </span><br><span class="line">[tom@xy ~]$ dd <span class="keyword">if</span>=/dev/zero of=/boot/tom bs=10M count=1  </span><br><span class="line">  dd: error writing <span class="string">&#x27;/boot/tom&#x27;</span>: Disk quato exceeded  </span><br><span class="line">  1+0 records <span class="keyword">in</span>  </span><br><span class="line">  1+0 records out  </span><br><span class="line">  8388608 bytes (8.4 MB) copied, 0.0238044s, 313MB/s  </span><br></pre></td></tr></table></figure>

<h3 id="11-创建链接文件ln"><a href="#11-创建链接文件ln" class="headerlink" title="11. 创建链接文件ln"></a>11. 创建链接文件ln</h3><p>:link:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ricklz/p/9378755.html">cnblog参考</a>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xy /]<span class="comment"># ln -s ../usr/share/zoneinfo/Asia/Shanghai /etc/localtime #相对目录建立, 找相对于链接的根目录</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>硬链接与软链接的区别:  </p>
<blockquote>
<p>ln src dst<br>    1、不能跨分区；<br>    2、删除源文件不影响链接文件；<br>    3、inode号不变，指向同一个文件；<br>    4、链接数增加；<br>##软链接：<br>ln -s src dst<br>    1、可以跨分区；<br>    2、删除源文件影响链接文件；<br>    3、inode号不相同；<br>    4、链接数不变；<br>ln -s ../boot/grub2/grub.cfg /etc/grub2.cfg</p>
</blockquote>
</blockquote>
<h3 id="12-RAID与LVM磁盘阵列技术"><a href="#12-RAID与LVM磁盘阵列技术" class="headerlink" title="12. RAID与LVM磁盘阵列技术  "></a>12. RAID与LVM磁盘阵列技术  <a id="raid"></a></h3><ul>
<li><p>RAID(fd)(Redundant Array of Independent Disks,独立冗余磁盘阵列)</p>
</li>
<li><p><strong>RAID 0(Srtiping)</strong>:把多块物理硬件设备(至少2块)通过硬件或软件凡事串联在一起,组成一个大的卷组,提升了硬盘数据的吞吐量,但不具备数据备份和错误修复能力； </p>
<ul>
<li>性能提升：读写；</li>
<li>冗余(容错)能力：无；</li>
<li>空间利用率：ns(s–&gt; 一块盘利用率)</li>
<li>至少2块<img src="/posts/296e7ad4/RAID0.png" class title="[RAID 0--条带]">
</li>
</ul>
</li>
<li><p><strong>RAID 1(Mirroring)</strong>:数据写到多块硬盘设备上,当某一块硬盘发生故障后,一般会立即以热交换方式来恢复数据的正常使用,但硬盘的使用率却下降了,只有33%左右 ✔   </p>
<ul>
<li>性能提升：写下降，读提升；</li>
<li>冗余能力：有；</li>
<li>空间利用率：1/2</li>
<li>至少2块<img src="/posts/296e7ad4/raid1.jpg" class title="[RAID 1--镜像]">
</li>
</ul>
</li>
<li><p><strong>RAID 5</strong>:将硬盘设备的数据奇偶校验信息保存到除自身外每一块硬盘设备上,当硬盘出现问题,通过奇偶校验信息来尝试重建损坏的数据  ✔</p>
<ul>
<li>性能提升：读写提升；</li>
<li>冗余能力：有；</li>
<li>空间利用率：(n-1)s/n</li>
<li>至少3块<img src="/posts/296e7ad4/raid5.jpg" class title="[RAID 5--校验]">
</li>
</ul>
</li>
<li><p><strong>RAID 10</strong>：RAID10=RAID 1 + RAID 0</p>
<ul>
<li>性能提升：读写提升；</li>
<li>冗余能力：有；</li>
<li>空间利用率：1/2</li>
<li>至少4块<img src="/posts/296e7ad4/raid-10.png" class title="[RAID 10--综合]">
</li>
</ul>
</li>
<li><p>mdadm 命令</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-C</td>
<td>创建 ✔</td>
</tr>
<tr>
<td>-v</td>
<td>显示过程 ✔</td>
</tr>
<tr>
<td>-a</td>
<td>检测设备名称</td>
</tr>
<tr>
<td>-n</td>
<td>指定设备数量 ✔</td>
</tr>
<tr>
<td>-l</td>
<td>指定RAID级别</td>
</tr>
<tr>
<td>-D</td>
<td>查看详细信息 ✔</td>
</tr>
<tr>
<td>-f</td>
<td>模拟设备损坏</td>
</tr>
<tr>
<td>-Q</td>
<td>查看摘要信息</td>
</tr>
<tr>
<td>-r</td>
<td>移除设备</td>
</tr>
<tr>
<td>-S</td>
<td>停止RAID磁盘阵列</td>
</tr>
<tr>
<td>-x</td>
<td>备用盘</td>
</tr>
</tbody></table>
<h3 id="12-1-部署磁盘阵列RAID-5-也可以拿分区做实验"><a href="#12-1-部署磁盘阵列RAID-5-也可以拿分区做实验" class="headerlink" title="12.1 部署磁盘阵列RAID 5(也可以拿分区做实验)"></a>12.1 部署磁盘阵列RAID 5(也可以拿分区做实验)</h3><h4 id="1-创建RAID-5："><a href="#1-创建RAID-5：" class="headerlink" title="1)创建RAID 5："></a>1)创建RAID 5：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mdadm -Cv -a yes /dev/md0 -n 3 -l 5 -x 1 /dev/sd&#123;c,d,e,f&#125;</span></span><br><span class="line">  mdadm: layout defaults to left-symmetric  </span><br><span class="line">  mdadm: layout defaults to left-symmetric  </span><br><span class="line">  mdadm: chunk size defaults to 512K  </span><br><span class="line">  mdadm: Defaulting to version 1.2 metadata  </span><br><span class="line">  mdadm: array /dev/md0 started.</span><br></pre></td></tr></table></figure>

<h4 id="2-查看RAID-5："><a href="#2-查看RAID-5：" class="headerlink" title="2)查看RAID 5："></a>2)查看RAID 5：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mdadm -D /dev/md0  </span></span><br><span class="line">[root@xy ~]<span class="comment"># watch -n &#x27;command&#x27;  # 周期性执行指定命令，并以全屏方式显示结果</span></span><br><span class="line">  /dev/md0:  </span><br><span class="line">  Version : 1.2  </span><br><span class="line">  Creation Time : Fri May 8 09:20:35 2018  </span><br><span class="line">  Raid Level : raid5  </span><br><span class="line">  Array Size : 41909248 (39.97 GiB 42.92 GB)  </span><br><span class="line">  Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  </span><br><span class="line">  Raid Devices : 3   </span><br><span class="line">  Total Devices : 4  </span><br><span class="line">  Persistence : Superblock is Persistence  </span><br><span class="line">  Update Time : Fri May 8 09:22:22 2018  </span><br><span class="line">  State : clean  </span><br><span class="line">  Active Devices : 3  </span><br><span class="line">  Working Devices : 4  </span><br><span class="line">  Failed Devices : 0  </span><br><span class="line">  Spare Devices : 1  </span><br><span class="line">  Layout : left-symmetric  </span><br><span class="line">  Chunk Size : 512K   </span><br><span class="line">  Name : xy.com:0 (<span class="built_in">local</span> to host xy.com)  </span><br><span class="line">  UUID : 111c244f:e080b0c1:3316b6f2:986fa663  </span><br><span class="line">  Events : 18  </span><br><span class="line">  Number Major Minor RaidDevice State  </span><br><span class="line">       0   8    16       0      active sync /dev/sdc  </span><br><span class="line">       1   8    32       1      active sync /dev/sdd  </span><br><span class="line">       4   8    48       2      active sync /dev/sde  </span><br><span class="line">       3   8    64       -      spare       /dev/sdf </span><br></pre></td></tr></table></figure>

<h4 id="3-格式化RAID-5："><a href="#3-格式化RAID-5：" class="headerlink" title="3)格式化RAID 5："></a>3)格式化RAID 5：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkfs.ext4 /dev/md0</span></span><br><span class="line">  mke2fs 1.42.9 (28-Dec-2013)  </span><br><span class="line">  Filesystem label=  </span><br><span class="line">  OS <span class="built_in">type</span>: Linux  </span><br><span class="line">  Block size=4096 (<span class="built_in">log</span>=2)  </span><br><span class="line">  Fragment size=4096 (<span class="built_in">log</span>=2)  </span><br><span class="line">  Stride=128 blocks, Stripe width=256 blocks  </span><br><span class="line">  2621440 inodes, 10477312 blocks  </span><br><span class="line">  523865 blocks (5.00%) reserved <span class="keyword">for</span> the super user  </span><br><span class="line">  First data block=0  </span><br><span class="line">  Maximum filesystem blocks=2157969408  </span><br><span class="line">  320 block groups  </span><br><span class="line">  32768 blocks per group, 32768 fragments per group  </span><br><span class="line">  8192 inodes per group  </span><br><span class="line">  Superblock backups stored on blocks:   </span><br><span class="line">    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,   </span><br><span class="line">    4096000, 7962624  </span><br><span class="line"></span><br><span class="line">  Allocating group tables: <span class="keyword">done</span>                              </span><br><span class="line">  Writing inode tables: <span class="keyword">done</span>                              </span><br><span class="line">  Creating journal (32768 blocks): <span class="keyword">done</span>  </span><br><span class="line">  Writing superblocks and filesystem accounting information: <span class="keyword">done</span> </span><br></pre></td></tr></table></figure>

<h4 id="4-挂载-RAID-5"><a href="#4-挂载-RAID-5" class="headerlink" title="4)挂载 RAID 5"></a>4)挂载 RAID 5</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># echo &quot;/dev/md0 /RAID ext4 defaults 0 0&quot; &gt;&gt; /etc/fstab  </span></span><br><span class="line">[root@xy ~]<span class="comment"># mkdir /RAID </span></span><br><span class="line">[root@xy ~]<span class="comment"># mount -a</span></span><br><span class="line">[root@xy ~]<span class="comment"># mdadm /dev/md0 -f /dev/sdc  </span></span><br><span class="line">  mdadm: <span class="built_in">set</span> /dev/sdc faulty <span class="keyword">in</span> /dev/md0  </span><br><span class="line">[root@xy ~]<span class="comment"># mdadm -D /dev/md0</span></span><br><span class="line">  /dev/md0:  </span><br><span class="line">  Version : 1.2  </span><br><span class="line">  Creation Time : Fri May 8 09:20:35 2018  </span><br><span class="line">  Raid Level : raid5  </span><br><span class="line">  Array Size : 41909248 (39.97 GiB 42.92 GB)  </span><br><span class="line">  Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  </span><br><span class="line">  Raid Devices : 3  </span><br><span class="line">  Total Devices : 4  </span><br><span class="line">  Persistence : Superblock is Persistence  </span><br><span class="line">  Update Time : Fri May 8 09:23:51 2018  </span><br><span class="line">  State : active, degraded, resering  </span><br><span class="line">  Active Devices : 2  </span><br><span class="line">  Working Devices :3  </span><br><span class="line">  Failed Devices : 1  </span><br><span class="line">  Spare Devices : 1  </span><br><span class="line">  Layout : left-symmetric  </span><br><span class="line">  Chunk Size : 512K  </span><br><span class="line">  Rebuild Status : 0% complete  </span><br><span class="line">  Name : xy.com:0 (<span class="built_in">local</span> to host xy.com)  </span><br><span class="line">  UUID : 111c244f:e080b0c1:3316b6f2:986fa663  </span><br><span class="line">  Events : 21  </span><br><span class="line">  Number Major Minor RaidDevice Status  </span><br><span class="line">       3   8    64       0      spare rebuilding /dev/sdf </span><br><span class="line">       1   8    32       1      active sync      /dev/sdd </span><br><span class="line">       4   8    48       2      active sync      /dev/sde </span><br><span class="line">       0   8    16       -      faulty           /dev/sdc  </span><br></pre></td></tr></table></figure>

<h4 id="12-3-部署磁盘阵列RAID-10"><a href="#12-3-部署磁盘阵列RAID-10" class="headerlink" title="12.3 部署磁盘阵列RAID 10:"></a>12.3 部署磁盘阵列RAID 10:</h4><h5 id="1-创建-RAID-10"><a href="#1-创建-RAID-10" class="headerlink" title="1) 创建 RAID 10:"></a>1) 创建 RAID 10:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mdadm -Cv /dev/md0 -a yes -n 4 -l 10 /dev/sd&#123;c,d,e,f&#125;     </span></span><br><span class="line">  mdadm: layout defaults to n2  </span><br><span class="line">  mdadm: layout defaults to n2  </span><br><span class="line">  mdadm: chunk size defaults to 512K  </span><br><span class="line">  mdadm: size <span class="built_in">set</span> to 20954624K  </span><br><span class="line">  mdadm: Defaulting to version 1.2 metadata  </span><br><span class="line">  mdadm: array /dev/md0 started. </span><br></pre></td></tr></table></figure>

<h5 id="2-格式化-RAID-10"><a href="#2-格式化-RAID-10" class="headerlink" title="2) 格式化 RAID 10:"></a>2) 格式化 RAID 10:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkfs.ext4 /dev/md0　# 格式化 ext4  </span></span><br><span class="line">  mke2fs 1.42.9 (28-Dec-2013)  </span><br><span class="line">  Filesystem label=  </span><br><span class="line">  OS <span class="built_in">type</span>: Linux  </span><br><span class="line">  Block size=4096 (<span class="built_in">log</span>=2)  </span><br><span class="line">  Fragment size=4096 (<span class="built_in">log</span>=2)  </span><br><span class="line">  Stride=128 blocks, Stripe width=256 blocks  </span><br><span class="line">  2621440 inodes, 10477312 blocks  </span><br><span class="line">  523865 blocks (5.00%) reserved <span class="keyword">for</span> the super user  </span><br><span class="line">  First data block=0  </span><br><span class="line">  Maximum filesystem blocks=2157969408  </span><br><span class="line">  320 block groups  </span><br><span class="line">  32768 blocks per group, 32768 fragments per group  </span><br><span class="line">  8192 inodes per group  </span><br><span class="line">  Superblock backups stored on blocks:   </span><br><span class="line">  32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,  </span><br><span class="line">  4096000, 7962624  </span><br><span class="line"></span><br><span class="line">  Allocating group tables: <span class="keyword">done</span>                           </span><br><span class="line">  Writing inode tables: <span class="keyword">done</span>                             </span><br><span class="line">  Creating journal (32768 blocks): <span class="keyword">done</span>  </span><br><span class="line">  Writing superblocks and filesystem accounting information: <span class="keyword">done</span>   </span><br></pre></td></tr></table></figure>

<h5 id="3-挂载-RAID-10"><a href="#3-挂载-RAID-10" class="headerlink" title="3) 挂载 RAID 10:"></a>3) 挂载 RAID 10:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkdir /RAID 　# 挂载 /dev/md0</span></span><br><span class="line">[root@xy ~]<span class="comment"># mount /dev/md0 /RAID/</span></span><br><span class="line">[root@xy ~]<span class="comment"># df -h  </span></span><br><span class="line">  Filesystem             Size  Used Avail Use% Mounted on  </span><br><span class="line">  /dev/mapper/rhel-root   28G  3.0G   25G  11% /  </span><br><span class="line">  devtmpfs               985M     0  985M   0% /dev  </span><br><span class="line">  tmpfs                  994M  148K  994M   1% /dev/shm  </span><br><span class="line">  tmpfs                  994M  8.8M  986M   1% /run  </span><br><span class="line">  tmpfs                  994M     0  994M   0% /sys/fs/cgroup  </span><br><span class="line">  /dev/sdb1              2.0G   33M  2.0G   2% /newFS  </span><br><span class="line">  /dev/sr0               3.5G  3.5G     0 100% /media/cdrom  </span><br><span class="line">  /dev/sda1              497M  119M  379M  24% /boot  </span><br><span class="line">  /dev/md0                40G   49M   38G   1% /RAID  </span><br></pre></td></tr></table></figure>

<h5 id="4-查看-RAID-10-信息"><a href="#4-查看-RAID-10-信息" class="headerlink" title="4) 查看 RAID 10 信息:"></a>4) 查看 RAID 10 信息:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mdadm -D /dev/md0 　# 查看 /dev/md0 磁盘阵列详细信息</span></span><br><span class="line">  /dev/md0:  </span><br><span class="line">        Version : 1.2  </span><br><span class="line">  Creation Time : Mon Jul  9 20:07:08 2018  </span><br><span class="line">     Raid Level : raid10  </span><br><span class="line">     Array Size : 41909248 (39.97 GiB 42.92 GB)  </span><br><span class="line">  Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  </span><br><span class="line">   Raid Devices : 4  </span><br><span class="line">  Total Devices : 4  </span><br><span class="line">    Persistence : Superblock is persistent  </span><br><span class="line">    </span><br><span class="line">    Update Time : Mon Jul  9 20:10:35 2018  </span><br><span class="line">          State : active, resyncing   </span><br><span class="line">  Active Devices : 4  </span><br><span class="line">  Working Devices : 4  </span><br><span class="line">  Failed Devices : 0  </span><br><span class="line">  Spare Devices : 0  </span><br><span class="line"></span><br><span class="line">         Layout : near=2  </span><br><span class="line">     Chunk Size : 512K  </span><br><span class="line"></span><br><span class="line">  Resync Status : 96% complete  </span><br><span class="line"></span><br><span class="line">           Name : xy.com:0  (<span class="built_in">local</span> to host xy.com)  </span><br><span class="line">           UUID : 111c244f:e080b0c1:3316b6f2:986fa663  </span><br><span class="line">         Events : 16  </span><br><span class="line"></span><br><span class="line">    Number   Major   Minor   RaidDevice State  </span><br><span class="line">       0       8       32        0      active sync   /dev/sdc  </span><br><span class="line">       1       8       48        1      active sync   /dev/sdd  </span><br><span class="line">       2       8       64        2      active sync   /dev/sde  </span><br><span class="line">       3       8       80        3      active sync   /dev/sdf  </span><br></pre></td></tr></table></figure>

<h4 id="12-2-模拟损坏磁盘阵列及修复："><a href="#12-2-模拟损坏磁盘阵列及修复：" class="headerlink" title="12.2 模拟损坏磁盘阵列及修复："></a>12.2 模拟损坏磁盘阵列及修复：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]# mdadm &#x2F;dev&#x2F;md0 -f &#x2F;dev&#x2F;sdc　# -f 模拟设备损坏 </span><br><span class="line">  mdadm: set &#x2F;dev&#x2F;sdc faulty in &#x2F;dev&#x2F;md0   </span><br><span class="line">[root@xy ~]# mdadm -D &#x2F;dev&#x2F;md0</span><br><span class="line">  &#x2F;dev&#x2F;md0:  </span><br><span class="line">          Version : 1.2  </span><br><span class="line">    Creation Time : Mon Jul  9 20:07:08 2018  </span><br><span class="line">       Raid Level : raid10  </span><br><span class="line">       Array Size : 41909248 (39.97 GiB 42.92 GB)  </span><br><span class="line">    Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  </span><br><span class="line">     Raid Devices : 4  </span><br><span class="line">    Total Devices : 4  </span><br><span class="line">      Persistence : Superblock is persistent  </span><br><span class="line"></span><br><span class="line">      Update Time : Mon Jul  9 20:23:34 2018  </span><br><span class="line">            State : clean, degraded   </span><br><span class="line">   Active Devices : 3  </span><br><span class="line">  Working Devices : 3  </span><br><span class="line">   Failed Devices : 1  </span><br><span class="line">    Spare Devices : 0  </span><br><span class="line"></span><br><span class="line">           Layout : near&#x3D;2  </span><br><span class="line">       Chunk Size : 512K  </span><br><span class="line"></span><br><span class="line">             Name : xy.com:0  (local to host xy.com)  </span><br><span class="line">             UUID : 111c244f:e080b0c1:3316b6f2:986fa663  </span><br><span class="line">           Events : 21  </span><br><span class="line"></span><br><span class="line">      Number   Major   Minor   RaidDevice State </span><br><span class="line">         0       0        0        0      removed  </span><br><span class="line">         1       8       48        1      active sync   &#x2F;dev&#x2F;sdd  </span><br><span class="line">         2       8       64        2      active sync   &#x2F;dev&#x2F;sde  </span><br><span class="line">         3       8       80        3      active sync   &#x2F;dev&#x2F;sdf  </span><br><span class="line"></span><br><span class="line">         0       8       32        -      faulty   &#x2F;dev&#x2F;sdc</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># reboot  </span></span><br><span class="line">[root@xy ~]<span class="comment"># umount /dev/RAID</span></span><br><span class="line">[root@xy ~]<span class="comment"># mdadm /dev/md0 -a /dev/sdc</span></span><br><span class="line">  mdadm: added /dev/sdc  </span><br><span class="line">[root@xy ~]<span class="comment"># mdadm -D /dev/md0</span></span><br><span class="line"></span><br><span class="line">  /dev/md0:  </span><br><span class="line">          Version : 1.2  </span><br><span class="line">    Creation Time : Mon Jul  9 20:07:08 2018  </span><br><span class="line">       Raid Level : raid10  </span><br><span class="line">       Array Size : 41909248 (39.97 GiB 42.92 GB)  </span><br><span class="line">    Used Dev Size : 20954624 (19.98 GiB 21.46 GB)  </span><br><span class="line">     Raid Devices : 4  </span><br><span class="line">    Total Devices : 4  </span><br><span class="line">      Persistence : Superblock is persistent  </span><br><span class="line"></span><br><span class="line">      Update Time : Mon Jul  9 21:04:28 2018 </span><br><span class="line">            State : clean, degraded, recovering   </span><br><span class="line">   Active Devices : 3  </span><br><span class="line">  Working Devices : 4  </span><br><span class="line">   Failed Devices : 0  </span><br><span class="line">    Spare Devices : 1  </span><br><span class="line"></span><br><span class="line">           Layout : near=2  </span><br><span class="line">       Chunk Size : 512K  </span><br><span class="line"></span><br><span class="line">   Rebuild Status : 19% complete  </span><br><span class="line">   </span><br><span class="line">             Name : xy.com:0  (<span class="built_in">local</span> to host xy.com)  </span><br><span class="line">             UUID : 111c244f:e080b0c1:3316b6f2:986fa663  </span><br><span class="line">           Events : 32 </span><br><span class="line"></span><br><span class="line">      Number   Major   Minor   RaidDevice State  </span><br><span class="line">         4       8       32        0      spare rebuilding   /dev/sdc  </span><br><span class="line">         1       8       48        1      active sync   /dev/sdd  </span><br><span class="line">         2       8       64        2      active sync   /dev/sde  </span><br><span class="line">         3       8       80        3      active sync   /dev/sdf  </span><br></pre></td></tr></table></figure>

<h3 id="13-LVM-8e-Logical-Volume-Manager，逻辑卷管理器"><a href="#13-LVM-8e-Logical-Volume-Manager，逻辑卷管理器" class="headerlink" title="13. LVM(8e) (Logical Volume Manager，逻辑卷管理器)  "></a>13. LVM(8e) (Logical Volume Manager，逻辑卷管理器)  <a id="lvm"></a></h3><blockquote>
<p>在硬盘分区和文件系统之间添加了一个逻辑层,提供了一个抽象的卷组，可以把多块硬盘进行卷合并实现对硬盘分区的<strong>动态调整</strong>    </p>
</blockquote>
<ul>
<li>物理卷(PV) 就是真正的<strong>物理硬盘或者分区</strong>；  </li>
<li>卷组(VG)  将多个物理卷合起来组成卷组，组成同一个卷组的物理卷可以是同一个硬盘的不同分区，也可以是不同硬盘的不同分区，<strong>抽象为一个逻辑硬盘</strong>；  </li>
<li>逻辑卷(LV) 卷组是一个逻辑硬盘，硬盘分区后才可以使用，类似的，从卷组出来的分区为逻辑卷，<strong>可以抽象为分区</strong></li>
</ul>
<img src="/posts/296e7ad4/%E9%80%BB%E8%BE%91%E5%8D%B7.png" class title="[LVM图示]">

<h4 id="13-1-常用LVM部署命令"><a href="#13-1-常用LVM部署命令" class="headerlink" title="13.1 常用LVM部署命令"></a>13.1 常用LVM部署命令</h4><table>
<thead>
<tr>
<th>项目</th>
<th>PV</th>
<th>VG</th>
<th>LV</th>
</tr>
</thead>
<tbody><tr>
<td>扫描</td>
<td>pvscan</td>
<td>vgscan</td>
<td>lvscan</td>
</tr>
<tr>
<td>建立</td>
<td>pvcreate</td>
<td>vgcreate</td>
<td>lvcreate</td>
</tr>
<tr>
<td>显示</td>
<td>pvs/pvdisplay</td>
<td>vgs/vgdisplay</td>
<td>lvs/lvdisplay</td>
</tr>
<tr>
<td>移除</td>
<td>pvremove</td>
<td>vgremove</td>
<td>lvremove</td>
</tr>
<tr>
<td>扩展</td>
<td>vgextend</td>
<td>vgextend</td>
<td>lvextend</td>
</tr>
<tr>
<td>缩小</td>
<td>vgreduce</td>
<td>vgreduce</td>
<td>lvreduce</td>
</tr>
</tbody></table>
<h4 id="13-2-创建LVM-PV-gt-VG-gt-LV-gt-mkfs-ext4-dev-storage-vo-gt-monut"><a href="#13-2-创建LVM-PV-gt-VG-gt-LV-gt-mkfs-ext4-dev-storage-vo-gt-monut" class="headerlink" title="13.2 创建LVM: PV -&gt; VG -&gt; LV -&gt; mkfs.ext4 /dev/storage/vo -&gt; monut"></a>13.2 创建LVM: PV -&gt; VG -&gt; LV -&gt; mkfs.ext4 /dev/storage/vo -&gt; monut</h4><h5 id="1-pvcrate-创建物理卷："><a href="#1-pvcrate-创建物理卷：" class="headerlink" title="1) pvcrate 创建物理卷："></a>1) pvcrate 创建物理卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># pvcreate /dev/sd&#123;c,d&#125;</span></span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdc&quot;</span> successfully created  </span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdd&quot;</span> successfully created</span><br></pre></td></tr></table></figure>

<h5 id="2-vgcrate-创建卷组管理："><a href="#2-vgcrate-创建卷组管理：" class="headerlink" title="2) vgcrate 创建卷组管理："></a>2) vgcrate 创建卷组管理：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vgcreate storage /dev/sd&#123;c,d&#125;  # 添加到storage卷组中 </span></span><br><span class="line">  Volume group <span class="string">&quot;storage&quot;</span> successfully created</span><br></pre></td></tr></table></figure>

<h5 id="3-vgdisplay-显示卷组管理："><a href="#3-vgdisplay-显示卷组管理：" class="headerlink" title="3) vgdisplay 显示卷组管理："></a>3) vgdisplay 显示卷组管理：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vgdisplay storage</span></span><br><span class="line">  --- Volume group ---  </span><br><span class="line">  VG Name               storage  </span><br><span class="line">  System ID               </span><br><span class="line">  Format                lvm2  </span><br><span class="line">  Metadata Areas        2  </span><br><span class="line">  Metadata Sequence No  1  </span><br><span class="line">  VG Access             <span class="built_in">read</span>/write  </span><br><span class="line">  VG Status             resizable  </span><br><span class="line">  MAX LV                0  </span><br><span class="line">  Cur LV                0  </span><br><span class="line">  Open LV               0  </span><br><span class="line">  Max PV                0  </span><br><span class="line">  Cur PV                2  </span><br><span class="line">  Act PV                2  </span><br><span class="line">  VG Size               39.99 GiB  </span><br><span class="line">  PE Size               4.00 MiB  <span class="comment"># -s 8M 指定PE大小  </span></span><br><span class="line">  Total PE              10238  </span><br><span class="line">  Alloc PE / Size       0 / 0    </span><br><span class="line">  Free  PE / Size       10238 / 39.99 GiB  </span><br><span class="line">  VG UUID               pjR9cJ-VoyM-TZsz-NdMb-s05a-0VQZ-wHhEBo </span><br></pre></td></tr></table></figure>

<h5 id="4-lvcrate-创建逻辑卷："><a href="#4-lvcrate-创建逻辑卷：" class="headerlink" title="4) lvcrate 创建逻辑卷："></a>4) lvcrate 创建逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># lvcreate -l 37 -n vo storage　# 从卷组里边 创建逻辑卷 lvcreate  </span></span><br><span class="line">  Logical volume <span class="string">&quot;vo&quot;</span> created   </span><br><span class="line">  -L 以容量为单位(-L 15G)  </span><br><span class="line">  -l 以PE（4MB）为单位</span><br></pre></td></tr></table></figure>

<h5 id="5-lvdisplay-显示逻辑卷："><a href="#5-lvdisplay-显示逻辑卷：" class="headerlink" title="5) lvdisplay 显示逻辑卷："></a>5) lvdisplay 显示逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># lvdisplay </span></span><br><span class="line">  --- Logical volume ---  </span><br><span class="line">  LV Path                /dev/storage/vo  </span><br><span class="line">  LV Name                vo  </span><br><span class="line">  VG Name                storage  </span><br><span class="line">  LV UUID                bDRxSW-f9X3-KkjE-UPJL-wsrj-2zXm-pCNpcq  </span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write  </span><br><span class="line">  LV Creation host, time xy.com, 2018-07-10 10:03:43 +0800  </span><br><span class="line">  LV Status              available  </span><br><span class="line">  open                 0  </span><br><span class="line">  LV Size                148.00 MiB  </span><br><span class="line">  Current LE             37  </span><br><span class="line">  Segments               1  </span><br><span class="line">  Allocation             inherit  </span><br><span class="line">  Read ahead sectors     auto  </span><br><span class="line">  currently <span class="built_in">set</span> to     8192  </span><br><span class="line">  Block device           253:2  </span><br></pre></td></tr></table></figure>

<h5 id="6-格式化逻辑卷："><a href="#6-格式化逻辑卷：" class="headerlink" title="6) 格式化逻辑卷："></a>6) 格式化逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkfs.ext4 /dev/storage/vo</span></span><br><span class="line">[root@xy ~]<span class="comment"># mke2fs -j /dev/storage/vo</span></span><br></pre></td></tr></table></figure>
<h5 id="7-挂载使用逻辑卷："><a href="#7-挂载使用逻辑卷：" class="headerlink" title="7) 挂载使用逻辑卷："></a>7) 挂载使用逻辑卷：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkdir /LVM </span></span><br><span class="line">[root@xy ~]<span class="comment"># mount /dev/storage/vo /LVM/</span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/fstab  </span></span><br><span class="line">  /dev/storage/vo              /LVM         ext4          defaults   0 0</span><br></pre></td></tr></table></figure>

<h5 id="8-扩容"><a href="#8-扩容" class="headerlink" title="8) 扩容"></a>8) 扩容</h5><p><strong>外加磁盘</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># fdisk t 8e</span></span><br><span class="line">[root@xy ~]<span class="comment"># mkfs.ext4 /dev/sdb1  # 不用分区也可以</span></span><br><span class="line">---</span><br><span class="line">[root@xy ~]<span class="comment"># pvcreate /dev/sdb1</span></span><br><span class="line">[root@xy ~]<span class="comment"># vgextend VolGroup /dev/sdb1</span></span><br><span class="line">[root@xy ~]<span class="comment"># lvextend -L +20G /dev/volGroup/VolGroup-lv_root</span></span><br><span class="line">[root@xy ~]<span class="comment"># resize2fs /dev/volGroup/VolGroup-lv_root</span></span><br></pre></td></tr></table></figure>

<p><strong>把其它分区分给空间不足的</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># umount /home   # 25G</span></span><br><span class="line">[root@xy ~]<span class="comment"># e2fsck -f /dev/volGroup/VolGroup-lv_home</span></span><br><span class="line">[root@xy ~]<span class="comment"># resize2fs -p /dev/volGroup/VolGroup-lv_home 10G   # xfs格式用xfs_growfs</span></span><br><span class="line">---</span><br><span class="line">[root@xy ~]<span class="comment"># mount /home</span></span><br><span class="line">[root@xy ~]<span class="comment"># lvreduce -L -15G /dev/volGroup/VolGroup-lv_home</span></span><br><span class="line">[root@xy ~]<span class="comment"># lvextend -L +15G 或 lvextend -l +100%FREE /dev/volGroup/VolGroup-lv_root</span></span><br><span class="line">[root@xy ~]<span class="comment"># resize2fs -p /dev/volGroup/VolGroup-lv_root</span></span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># fuser -m -v /home</span></span><br><span class="line">[root@xy ~]<span class="comment"># kill -9 PID</span></span><br><span class="line"><span class="comment"># 建议保留Free PE／SIZE 一点空间，不要全用上；</span></span><br></pre></td></tr></table></figure>

<h3 id="14-逻辑卷快照-类似于虚拟机快照-特点-快照卷容量必须等同于逻辑卷容量-快照卷是一次性的-执行后会立即自动删除"><a href="#14-逻辑卷快照-类似于虚拟机快照-特点-快照卷容量必须等同于逻辑卷容量-快照卷是一次性的-执行后会立即自动删除" class="headerlink" title="14. 逻辑卷快照:类似于虚拟机快照, 特点:快照卷容量必须等同于逻辑卷容量; 快照卷是一次性的, 执行后会立即自动删除"></a>14. 逻辑卷快照:类似于虚拟机快照, 特点:快照卷容量必须等同于逻辑卷容量; 快照卷是一次性的, 执行后会立即自动删除</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vgdisplay</span></span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               storage  </span><br><span class="line">  System ID             </span><br><span class="line">  Format                lvm2 </span><br><span class="line">  ...</span><br><span class="line">  Total PE              10238</span><br><span class="line">  Alloc PE / Size       37 / 148.00 MiB　<span class="comment"># PE 创建快照大小依据</span></span><br><span class="line">  Free  PE / Size       10201 / 39.85 GiB</span><br><span class="line">  VG UUID          6YZPns-qgdy-yEFx-hEZ3-bLwe-2eDd-PFEip8</span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># echo &quot;Welcome to linux&quot; &gt; /LVM/readme.txt </span></span><br><span class="line">[root@xy ~]<span class="comment"># lvcreate -L 148M -n SNAP -p r -s /dev/storage/vo 　# -s创建快照卷  </span></span><br><span class="line">  Logical volume <span class="string">&quot;SNAP&quot;</span> created</span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># lvdisplay </span></span><br><span class="line"></span><br><span class="line">  --- Logical volume ---  </span><br><span class="line">  LV Path                /dev/storage/vo  </span><br><span class="line">  LV Name                vo  </span><br><span class="line">  VG Name                storage  </span><br><span class="line">  ...  </span><br><span class="line">  LV snapshot status     <span class="built_in">source</span> of  SNAP [active]  </span><br><span class="line">  LV Status              available  </span><br><span class="line">  open                 1</span><br><span class="line">  LV Size               148.00 MiB  </span><br><span class="line">  ...</span><br><span class="line">  currently <span class="built_in">set</span> to     8192  </span><br><span class="line">  Block device           253:2  </span><br><span class="line"></span><br><span class="line">  --- Logical volume ---  </span><br><span class="line">  LV Path                /dev/storage/SNAP </span><br><span class="line">  LV Name                SNAP  </span><br><span class="line">  VG Name                storage  </span><br><span class="line">  LV UUID                dERsif-hvjx-20JJ-1BLn-dPxb-aYtw-n1zetn  </span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write  </span><br><span class="line">  LV Creation host, time xy.com, 2018-07-10 14:00:46 +0800  </span><br><span class="line">  LV snapshot status     active destination <span class="keyword">for</span> vo  </span><br><span class="line">  LV Status              available  </span><br><span class="line">  open                 0  </span><br><span class="line">  LV Size                148.00 MiB  </span><br><span class="line">  ...</span><br><span class="line">  Block device           253:3</span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># dd if=/dev/zero of=/LVM/files count=1 bs=100M</span></span><br><span class="line">[root@xy ~]<span class="comment"># mount -o /dev/storage/SNAP /mnt/SNAP  # ext4  </span></span><br><span class="line">[root@xy ~]<span class="comment"># mount -o nouuid,ro /dev/storage/SNAP /mnt/SNAP  # xfs  </span></span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># umount /LVM</span></span><br><span class="line">[root@xy ~]<span class="comment"># umount /mnt/SANP    </span></span><br><span class="line">[root@xy ~]<span class="comment"># lvconvert --merge /dev/storage/SNAP 　# 快照还原  </span></span><br><span class="line">   Merging of volume SNAP started.  </span><br><span class="line">   vo: Merged: 33.5%  </span><br><span class="line">   vo: Merged: 100.0%  </span><br><span class="line">   Merge of snapshot into logical volume vo has finished.  </span><br><span class="line">   Logical volume <span class="string">&quot;SNAP&quot;</span> successfully removed</span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># mount /dev/storage/vo /LVM/    </span></span><br><span class="line">[root@xy ~]<span class="comment"># ls /LVM/  </span></span><br><span class="line">  lost+found  readme.txt</span><br></pre></td></tr></table></figure>

<h3 id="15-删除逻辑卷-LV-gt-VG-gt-PV"><a href="#15-删除逻辑卷-LV-gt-VG-gt-PV" class="headerlink" title="15. 删除逻辑卷: LV -&gt; VG -&gt; PV"></a>15. 删除逻辑卷: LV -&gt; VG -&gt; PV</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]# umount &#x2F;LVM&#x2F;</span><br><span class="line">[root@xy ~]# lvremove &#x2F;dev&#x2F;storage&#x2F;vo　# lvremove</span><br><span class="line">  Do you really want to remove active  logical volume vo? [y&#x2F;n]: y</span><br><span class="line">  Logical volume &quot;vo&quot; successfully</span><br><span class="line">  removed</span><br><span class="line">[root@xy ~]# vgremove storage</span><br><span class="line">  Volume group &quot;storage&quot; successfully removed</span><br><span class="line">[root@xy ~]# pvremove &#x2F;dev&#x2F;sdc &#x2F;dev&#x2F;sdd</span><br><span class="line">  Labels on physical volume &quot;&#x2F;dev&#x2F;sdc&quot; successfully wiped  </span><br><span class="line">  Labels on physical volume &quot;&#x2F;dev&#x2F;sdd&quot; successfully wiped</span><br></pre></td></tr></table></figure>

<h3 id="16-iptables-与-firewalld-防火墙-四表五链"><a href="#16-iptables-与-firewalld-防火墙-四表五链" class="headerlink" title="16. iptables 与 firewalld 防火墙(四表五链)"></a>16. iptables 与 firewalld 防火墙(四表五链)</h3><h4 id="16-1-iptables命令-参数-策略规则链-动作-："><a href="#16-1-iptables命令-参数-策略规则链-动作-：" class="headerlink" title="16.1 iptables命令  参数 + 策略规则链 + 动作 ："></a>16.1 iptables命令  参数 + 策略规则链 + 动作 ：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables  [-t 表名]  选项 [链名]  [条件]  [-j 控制类型]</span><br><span class="line">1）默认filter表；</span><br><span class="line">2）默认表内所有链； </span><br><span class="line">3）选项、链名、控制类型使用大写字母，其余均为小写；</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-P</td>
<td>设置默认策略   ✔</td>
</tr>
<tr>
<td>-F</td>
<td>清空规则链  ✔</td>
</tr>
<tr>
<td>-L</td>
<td>查看规则链  ✔</td>
</tr>
<tr>
<td>-A</td>
<td>在规则链的 末尾 添加新规则   ✔</td>
</tr>
<tr>
<td>-I num</td>
<td>在规则链的 头部 添加新规则    ✔</td>
</tr>
<tr>
<td>-D num</td>
<td>删除某一条规则  ✔ <code>iptables -t 表明 -D 链名 num</code></td>
</tr>
<tr>
<td>-s IP/MASK</td>
<td>匹配来源地址IP/MASK,加!表示除这个IP外</td>
</tr>
<tr>
<td>-d IP/MASK</td>
<td>匹配目标地址(多个IP用逗号隔开)</td>
</tr>
<tr>
<td>-i 网卡名称</td>
<td>匹配从这块网卡流入的数据(PREROUTING、INPUT、FORWARD)</td>
</tr>
<tr>
<td>-o 网卡名称</td>
<td>匹配从这块网卡流出的数据(FORWARD、OUTPUT、POSTROUTING)</td>
</tr>
<tr>
<td>-p Protocol</td>
<td>匹配协议,如:TCP/UDP/ICMP</td>
</tr>
<tr>
<td>–dport num</td>
<td>匹配目标端口号</td>
</tr>
<tr>
<td>–sport num</td>
<td>匹配来源端口号</td>
</tr>
<tr>
<td>-v</td>
<td>数据报文 字节数显示(信息更全) <code>iptables --line-number -vnL INPUT</code></td>
</tr>
<tr>
<td>-n</td>
<td>以数字形式显示IP地址、端口</td>
</tr>
<tr>
<td><code>--line-numbers</code></td>
<td>查看规则，显示序号   ✔</td>
</tr>
<tr>
<td>-N -E -X</td>
<td>自定义、重命名、删除自定义链</td>
</tr>
<tr>
<td>-m,–module</td>
<td>扩展模块</td>
</tr>
<tr>
<td>—</td>
<td>-m multiport –sport  用于匹配报文源端口,多个端口用逗号隔开</td>
</tr>
<tr>
<td>—</td>
<td>-m multiport –dport  用于匹配报文目的端口,多个端口用逗号隔开</td>
</tr>
<tr>
<td>—</td>
<td>-m iprange –src-range  IP范围</td>
</tr>
<tr>
<td>—</td>
<td>-m iprange –dst-range  IP范围</td>
</tr>
<tr>
<td>—</td>
<td>-m mac –macl-source  MAC地址</td>
</tr>
<tr>
<td>—</td>
<td>-m tcp –sport 用于匹配tcp协议报文源端口,用冒号定义连续端口</td>
</tr>
<tr>
<td>—</td>
<td>-m tcp –dport 用于匹配tcp协议报文目的端口,用冒号定义连续端口</td>
</tr>
<tr>
<td>-m state –state</td>
<td>连接状态</td>
</tr>
<tr>
<td>—</td>
<td>NEW,ESTABLISHED,RELATED -j ACCEPT</td>
</tr>
</tbody></table>
<h4 id="16-2-策略规则链-iptables-服务把用于处理或过滤流量的策略条目称为规则-多条规则可组成一个规则链-而规则链则依据数据包处理位置的不同进行分类-具体如下："><a href="#16-2-策略规则链-iptables-服务把用于处理或过滤流量的策略条目称为规则-多条规则可组成一个规则链-而规则链则依据数据包处理位置的不同进行分类-具体如下：" class="headerlink" title="16.2 策略规则链[iptables]服务把用于处理或过滤流量的策略条目称为规则,多条规则可组成一个规则链,而规则链则依据数据包处理位置的不同进行分类,具体如下："></a>16.2 策略规则链[iptables]服务把用于处理或过滤流量的策略条目称为规则,多条规则可组成一个规则链,而规则链则依据数据包处理位置的不同进行分类,具体如下：<a id="iptables"></a></h4><ul>
<li>报文路径: <ul>
<li>到本机某进程的报文（<code>PREROUTING --&gt; INPUT</code>）;</li>
<li>由本机转发的报文（<code>PREROUTING --&gt; FORWARD--&gt; POSTROUTING</code>）;</li>
<li>由本机的某进程发出报文，即响应报文（<code>OUTPUT --&gt; POSTROUTING</code>）;</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>四表(相同功能规则的集合)</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>raw表</code></td>
<td>关闭nat启用的连接追踪机制</td>
</tr>
<tr>
<td><code>mangle表</code></td>
<td>拆解报文，做出修改，重新封装功能</td>
</tr>
<tr>
<td><code>nat表</code></td>
<td>网络地址转换功能，内核模块</td>
</tr>
<tr>
<td><code>filter表</code></td>
<td>过滤功能，防火墙，内核模块</td>
</tr>
</tbody></table>
<hr>
<table>
<thead>
<tr>
<th>五链(钩子)</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>PREROUTING链</code></td>
<td>在进行路由选择前处理数据包(raw&gt;mangle&gt;nat)</td>
</tr>
<tr>
<td><code>INPUT链</code></td>
<td>处理流入数据包</td>
</tr>
<tr>
<td><code>OUTPUT链</code></td>
<td>处理流出数据包</td>
</tr>
<tr>
<td><code>FORWARD链</code></td>
<td>处理转发数据包</td>
</tr>
<tr>
<td><code>POSTROUTING链</code></td>
<td>在进行路由选择后处理数据包</td>
</tr>
</tbody></table>
<p><strong>-L 查看规则链</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -L  # -L 查看规则链 Look  </span></span><br><span class="line">  Chain INPUT (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>        destination           </span><br><span class="line">  ACCEPT     all  --  anywhere      anywhere             ctstate RELATED,ESTABLISHED  </span><br><span class="line">  ACCEPT     all  --  anywhere      anywhere              </span><br><span class="line">  INPUT_direct  all  --  anywhere   anywhere                         </span><br><span class="line">  ........省略部分输出信息........  </span><br><span class="line">[root@xy ~]<span class="comment"># iptables-save &gt; /home/User/iptables.bak         # 备份</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables-restore &lt; /home/User/iptables.bak      # 还原</span></span><br></pre></td></tr></table></figure>

<p><strong>-F 清空规则链</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -F 　</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -L  </span></span><br><span class="line">  Chain INPUT (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>               destination   </span><br><span class="line"></span><br><span class="line">  Chain FORWARD (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>               destination   </span><br><span class="line"></span><br><span class="line">  Chain OUTPUT (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>               destination   </span><br><span class="line">  </span><br><span class="line">  ........省略部分输出信息........  </span><br></pre></td></tr></table></figure>

<p><strong>iptables -P参数默认策略 INPUT规则链 DROP动作</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -P INPUT DROP</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -L  </span></span><br><span class="line">   Chain INPUT (policy DROP)    </span><br><span class="line">   ........省略部分输出信息........  </span><br></pre></td></tr></table></figure>

<p><strong>iptables -I头部添加新规则 INPUT规则链 -p icmp ACCEPT动作</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -I INPUT -p icmp -j ACCEPT</span></span><br></pre></td></tr></table></figure>

<p><strong>iptables -D删除某一条规则 INPUT规则链 序号</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -D INPUT 1</span></span><br></pre></td></tr></table></figure>

<p><strong>iptables -P默认策略 INPUT规则链 ACCEPT动作</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -P INPUT ACCEPT</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -L</span></span><br><span class="line">  Chain INPUT (policy ACCEPT)</span><br><span class="line">  ........省略部分输出信息........</span><br></pre></td></tr></table></figure>

<h4 id="16-4-仅允许指定网段的主机访问本机的22端口-SSH"><a href="#16-4-仅允许指定网段的主机访问本机的22端口-SSH" class="headerlink" title="16.4 仅允许指定网段的主机访问本机的22端口 SSH"></a>16.4 仅允许指定网段的主机访问本机的22端口 SSH</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#iptables -I头部添加新规则 INPUT规则链 源IP -p tcp --dport 22 ACCEPT动作  </span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -I INPUT -s 192.168.37.0/24 -p tcp --dport 22 -j ACCEPT　　</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#iptables -A尾部添加新规则 INPUT规则链 -p tcp --dport 22 REJECT动作</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -A INPUT -p tcp --dport 22 -j REJECT</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -L</span></span><br><span class="line">  Chain INPUT (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>               destination           </span><br><span class="line">  ACCEPT     tcp  --  192.168.37.0/24      anywhere             tcp dpt:ssh  </span><br><span class="line">  REJECT     tcp  --  anywhere             anywhere             tcp dpt:ssh   </span><br><span class="line">  reject-with icmp-port-unreachable  </span><br><span class="line">  ........省略部分输出信息........   </span><br><span class="line"></span><br><span class="line">[root@clientA ~]<span class="comment"># ssh 192.168.37.10　# 网段192.168.37.0/24 是可以的  </span></span><br><span class="line">[root@clientA ~]<span class="comment"># ssh 192.168.37.10　# 网段192.168.20.0/24 XXXXXXXX</span></span><br><span class="line">  Connecting to 192.168.37.10:22...</span><br><span class="line">  Could not connect to <span class="string">&#x27;192.168.37.10&#x27;</span>(port 22): Connection failed  </span><br></pre></td></tr></table></figure>

<h4 id="16-5-INPUT-规则链加入拒绝所有人访问本机12345端口的策略规则"><a href="#16-5-INPUT-规则链加入拒绝所有人访问本机12345端口的策略规则" class="headerlink" title="16.5 INPUT 规则链加入拒绝所有人访问本机12345端口的策略规则"></a>16.5 INPUT 规则链加入拒绝所有人访问本机12345端口的策略规则</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -I INPUT -p tcp --dport 12345 -j REJECT   </span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -I INPUT -p udp --dport 12345 -j REJECT  </span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -L</span></span><br><span class="line">  Chain INPUT (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>               destination           </span><br><span class="line">  REJECT     udp  --  anywhere             anywhere             udp dpt:italk   </span><br><span class="line">  reject-with icmp-port-unreachable  </span><br><span class="line">  REJECT     tcp  --  anywhere             anywhere             tcp dpt:italk   </span><br><span class="line">  reject-with icmp-port-unreachable  </span><br><span class="line">  ACCEPT     tcp  --  192.168.37.0/24      anywhere             tcp dpt:ssh  </span><br><span class="line">  REJECT     tcp  --  anywhere             anywhere             tcp dpt:ssh   </span><br><span class="line">  reject-with icmp-port-unreachable  </span><br><span class="line">  ........省略部分输出信息........  </span><br></pre></td></tr></table></figure>

<h4 id="16-6-INPUT-规则链加入拒绝所有人访问本机1000-1024端口的策略规则"><a href="#16-6-INPUT-规则链加入拒绝所有人访问本机1000-1024端口的策略规则" class="headerlink" title="16.6 INPUT 规则链加入拒绝所有人访问本机1000:1024端口的策略规则"></a>16.6 INPUT 规则链加入拒绝所有人访问本机1000:1024端口的策略规则</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -A INPUT -p tcp --dport 1000:1024 -j REJECT</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -A INPUT -p udp --dport 1000:1024 -j REJECT</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -L</span></span><br><span class="line">  Chain INPUT (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>               destination           </span><br><span class="line">  REJECT     udp  --  anywhere             anywhere             udp dpt:italk   </span><br><span class="line">  reject-with icmp-port-unreachable  </span><br><span class="line">  REJECT     tcp  --  anywhere             anywhere             tcp dpt:italk   </span><br><span class="line">  reject-with icmp-port-unreachable  </span><br><span class="line">  ACCEPT     tcp  --  192.168.37.0/24      anywhere             tcp dpt:ssh  </span><br><span class="line">  REJECT     tcp  --  anywhere             anywhere             tcp dpt:ssh   </span><br><span class="line">  ........省略部分输出信息........  </span><br></pre></td></tr></table></figure>

<h4 id="16-7-INPUT-规则链加入拒绝192-168-37-5访问本机80端口的策略规则"><a href="#16-7-INPUT-规则链加入拒绝192-168-37-5访问本机80端口的策略规则" class="headerlink" title="16.7 INPUT 规则链加入拒绝192.168.37.5访问本机80端口的策略规则"></a>16.7 INPUT 规则链加入拒绝192.168.37.5访问本机80端口的策略规则</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -I INPUT -p tcp -s 192.168.37.5 --dport 80 -j REJECT</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -L</span></span><br><span class="line">  Chain INPUT (policy ACCEPT)  </span><br><span class="line">  target     prot opt <span class="built_in">source</span>               destination           </span><br><span class="line">  REJECT     tcp  --  192.168.37.5         anywhere             tcp dpt:http   </span><br><span class="line">  reject-with icmp-port-unreachable</span><br><span class="line">  ........省略部分输出信息........  </span><br><span class="line">[root@xy ~]<span class="comment"># service iptables save　 # 永久生效</span></span><br><span class="line">  iptables: Saving firewall rules to /etc/sysconfig/iptables:[  OK  ]</span><br></pre></td></tr></table></figure>

<h4 id="16-8-禁止源自192-168-10-0-24-网段的流量访问本机sshd服务："><a href="#16-8-禁止源自192-168-10-0-24-网段的流量访问本机sshd服务：" class="headerlink" title="16.8 禁止源自192.168.10.0/24 网段的流量访问本机sshd服务："></a>16.8 禁止源自192.168.10.0/24 网段的流量访问本机sshd服务：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -I INPUT -s 192.168.10.0/24 -p tcp --dport 22 -j REJECT  </span></span><br><span class="line">[root@xt ~]<span class="comment"># service iptables save</span></span><br></pre></td></tr></table></figure>

<h4 id="16-9-SNAT-amp-amp-DNAT"><a href="#16-9-SNAT-amp-amp-DNAT" class="headerlink" title="16.9 SNAT &amp;&amp; DNAT"></a>16.9 SNAT &amp;&amp; DNAT</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># modprobe ip_tables  </span></span><br><span class="line">[root@xy ~]<span class="comment"># modprobe</span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/sysctl.conf  # /proc/sys/net/ipv4/ip_forward  </span></span><br><span class="line">[root@xy ~]<span class="comment"># net.ipv4.ip_forward  = 1 </span></span><br><span class="line">[root@xy ~]<span class="comment"># sysctl -p /etc/sysctl.conf  </span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -F</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#网关服务器: eth0(192.168.1.1) eth1(218.29.30.31) </span></span><br><span class="line"><span class="comment">#局域网客户机(服务器): 192.168.1.6</span></span><br><span class="line"><span class="comment">#公网服务器(客户机): 58.63.236.45</span></span><br></pre></td></tr></table></figure>

<h4 id="16-10-SNAT-转换规则：内网访问外网-路由后交给SNAT"><a href="#16-10-SNAT-转换规则：内网访问外网-路由后交给SNAT" class="headerlink" title="16.10 SNAT 转换规则：内网访问外网(路由后交给SNAT)"></a>16.10 SNAT 转换规则：内网访问外网(路由后交给SNAT)</h4><img src="/posts/296e7ad4/SNAT.png" class title="[SNAT转换]">  

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -t nat -A  POSTROUTING -s 192.168.1.0/24 -o eth1 -j SNAT --to-source 218.29.30.31     </span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -t nat -A  POSTROUTING -s 192.168.1.0/24 -o eth1 -j MASQUERADE  </span></span><br><span class="line">[root@xy ~]<span class="comment"># service iptables save</span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/sysconfig/iptables  </span></span><br><span class="line">[root@xy~]<span class="comment"># tcpdump -i eth0 -nn -X icmp</span></span><br></pre></td></tr></table></figure>

<h4 id="16-11-DNAT-转换规则：外网访问内网-路由前交给DNAT"><a href="#16-11-DNAT-转换规则：外网访问内网-路由前交给DNAT" class="headerlink" title="16.11 DNAT 转换规则：外网访问内网(路由前交给DNAT)"></a>16.11 DNAT 转换规则：外网访问内网(路由前交给DNAT)</h4><img src="/posts/296e7ad4/DNAT.png" class title="[DNAT转换]"> 

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -t nat -A  PREROUTING -d 218.29.30.31 -i eth1 -p tcp --dport 8080 -j DNAT --to-destination 192.168.1.6:80      </span></span><br><span class="line">[root@xy ~]<span class="comment"># service iptables save</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables-save &gt; 1.iptables</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables-restore &lt; 1.iptables</span></span><br></pre></td></tr></table></figure>

<h4 id="16-12-解决Windows访问Samba服务拒绝的方法"><a href="#16-12-解决Windows访问Samba服务拒绝的方法" class="headerlink" title="16.12 解决Windows访问Samba服务拒绝的方法:"></a>16.12 解决Windows访问Samba服务拒绝的方法:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># iptables -L --line-number -n    # 以带有序号形式查看规则</span></span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -t filter -I INPUT 7 -p udp -m multiport --dport 139,445 -j ACCEPT</span></span><br><span class="line">[root@xy ~]<span class="comment"># iptables -t filter -I INPUT 7 -p tcp -m multiport --dport 139,445 -m state --state NEW  -j ACCEPT</span></span><br></pre></td></tr></table></figure>

<h3 id="17-firewalld-Dynamic-Firewall-Manager-of-Linux-system-Linux动态防火墙管理器"><a href="#17-firewalld-Dynamic-Firewall-Manager-of-Linux-system-Linux动态防火墙管理器" class="headerlink" title="17 firewalld(Dynamic Firewall Manager of Linux system):Linux动态防火墙管理器 "></a>17 firewalld(Dynamic Firewall Manager of Linux system):Linux动态防火墙管理器 <a id="firewalld"></a></h3><p>管理方式:CLI(命令行界面) 与 GUI(图形用户界面)</p>
<h4 id="17-1-firewalld中常用的区域名及策略规则"><a href="#17-1-firewalld中常用的区域名及策略规则" class="headerlink" title="17.1 firewalld中常用的区域名及策略规则:"></a>17.1 firewalld中常用的区域名及策略规则:</h4><table>
<thead>
<tr>
<th>区域</th>
<th>默认规则策略</th>
</tr>
</thead>
<tbody><tr>
<td>trusted</td>
<td>允许所有数据包</td>
</tr>
<tr>
<td>home</td>
<td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh、mdns、ipp-client、amba-client与dhcpv6-client服务相关,则允许流量</td>
</tr>
<tr>
<td>internal</td>
<td>等同于home区域</td>
</tr>
<tr>
<td>public</td>
<td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh、dhcpv6-client服务相关,则允许流量</td>
</tr>
<tr>
<td>external</td>
<td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh服务相关,则允许流量</td>
</tr>
<tr>
<td>dmz</td>
<td>拒绝流入的流量,除非与流出的流量相关;而如果流量与ssh服务相关,则允许流量</td>
</tr>
<tr>
<td>block</td>
<td>拒绝流入的流量,除非与流出的流量相关</td>
</tr>
<tr>
<td>drop</td>
<td>拒绝流入的流量,除非与流出的流量相</td>
</tr>
</tbody></table>
<h4 id="17-2-firewall-cmd-命令"><a href="#17-2-firewall-cmd-命令" class="headerlink" title="17.2 firewall-cmd 命令:"></a>17.2 firewall-cmd 命令:</h4><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>--get-default-zone</code></td>
<td>查询默认区域名称</td>
</tr>
<tr>
<td><code>--set-default-zone=&lt;区域名称&gt;</code></td>
<td>设置默认区域,使其永久生效</td>
</tr>
<tr>
<td><code>--get-zones</code></td>
<td>显示可用区域</td>
</tr>
<tr>
<td><code>--get-services</code></td>
<td>显示预先定义服务</td>
</tr>
<tr>
<td><code>--get-active-zones</code></td>
<td>显示当前正使用的区域与网卡名称</td>
</tr>
<tr>
<td><code>--add-source=</code></td>
<td>将源自此IP/子网流量导向某个指定区域</td>
</tr>
<tr>
<td><code>--remove-source=</code></td>
<td>不再将源自此IP/子网流量导向某个指定区域</td>
</tr>
<tr>
<td><code>--add-interface=&lt;网卡名称&gt;</code></td>
<td>将源自此网卡所有流量导向某个指定区域</td>
</tr>
<tr>
<td><code>--change-interface=&lt;网卡名称&gt;</code></td>
<td>将某个网卡与区域进行关联</td>
</tr>
<tr>
<td><code>--list-all</code></td>
<td>显示当前区域网卡配置参数/资源/端口/服务</td>
</tr>
<tr>
<td><code>--list-all-zones</code></td>
<td>显示所有区域网卡配置参数/资源/端口/服务</td>
</tr>
<tr>
<td><code>--add-service=&lt;服务名&gt;</code></td>
<td>设置默认区域允许该服务的流量</td>
</tr>
<tr>
<td><code>--add-port=&lt;端口号/协议&gt;</code></td>
<td>设置默认区域允许该端口的流量</td>
</tr>
<tr>
<td><code>--remove-service=&lt;服务名&gt;</code></td>
<td>设置默认区域不再允许该服务的流量</td>
</tr>
<tr>
<td><code>--remove-port=&lt;端口号/协议&gt;</code></td>
<td>设置默认区域不再允许该端口的流量</td>
</tr>
<tr>
<td><code>--reload</code></td>
<td>让永久生效的配置规则立即生效,覆盖当前配置规则</td>
</tr>
<tr>
<td><code>--panic-on</code></td>
<td>开启应急状况模式</td>
</tr>
<tr>
<td><code>--panic-off</code></td>
<td>关闭应急状况模式</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --get-default-zone  </span></span><br><span class="line">  public  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --get-zone-of-interface=eno16777736  </span></span><br><span class="line">  public  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --permanent --zone=external --change-interface=eno16777736    </span></span><br><span class="line">  success　<span class="comment"># 重启后生效</span></span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --get-zone-of-interface=eno16777736</span></span><br><span class="line">  external</span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --set-default-zone=public  # firewall当前服务设置为public  </span></span><br><span class="line">  success </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --panic-on # 启动/关闭防火墙应急状况模式,阻断一切网络连接  </span></span><br><span class="line">  success  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --panic-off</span></span><br><span class="line">  success  </span><br></pre></td></tr></table></figure>

<p><strong>查询public区域是否允许请求SSH和HTTPS协议流量</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --zone=public --query-service=ssh</span></span><br><span class="line">  yes  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --zone=public --query-service=https</span></span><br><span class="line">  no   </span><br></pre></td></tr></table></figure>

<p><strong>firewalld服务中请求HTTPS协议流量设置永久允许,立即生效</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --zone=public --add-service=https</span></span><br><span class="line">  success  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --permanent --zone=public --add-service=https</span></span><br><span class="line">  success  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --reload  # 更改设置立即生效 </span></span><br><span class="line">  success  </span><br></pre></td></tr></table></figure>

<p><strong>firewalld服务中请求HTTP协议流量设置永久拒绝,立即生效</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --permanent --zone=public --remove-service=http # permanent</span></span><br><span class="line">  success  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">  success  </span><br></pre></td></tr></table></figure>

<p><strong>firewalld　服务中访问8080 8081端口流量策略设置允许,仅当前生效</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --zone=public --add-port=8080-8081/tcp</span></span><br><span class="line">  success  </span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --zone=public --list-ports 8080-8081/tcp  </span></span><br></pre></td></tr></table></figure>

<p><strong>流量转发 访问本机888端口的流量转发到22端口</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --permanent --zone=public     --add-forward-port=port=888:proto=tcp:toport=22:toaddr=192.168.37.10</span></span><br><span class="line">[root@xy ~]<span class="comment"># firewall-cmd --reload  </span></span><br><span class="line">  success  </span><br></pre></td></tr></table></figure>

<p><strong>服务的ACL</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim /etc/hosts.deny</span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/host.allow</span></span><br></pre></td></tr></table></figure>

<h3 id="18-使用SSH服务管理远程主机"><a href="#18-使用SSH服务管理远程主机" class="headerlink" title="18. 使用SSH服务管理远程主机"></a>18. 使用SSH服务管理远程主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># nmtui  # GUI配置网络参数</span></span><br><span class="line">[root@xy ~]<span class="comment"># cd /etc/sysconfig/network-scripts/</span></span><br><span class="line">[root@xy network-scripts]<span class="comment"># vim ifcfg-eno16777736  </span></span><br><span class="line">[root@xy network-scripts]<span class="comment"># systemctl restart network </span></span><br><span class="line">[root@xy network-scripts]<span class="comment"># ping -c 4 192.168.37.10 </span></span><br><span class="line">  PING 192.168.37.10 (192.168.37.10) 56(84) bytes of data.  </span><br><span class="line">  64 bytes from 192.168.37.10: icmp_seq=1 ttl=64 time=31.3 ms  </span><br><span class="line">  --- 192.168.37.10 ping statistics ---  </span><br><span class="line">  4 packets transmitted, 4 received, 0% packet loss, time 3005ms  </span><br><span class="line">  rtt min/avg/max/mdev = 0.183/8.006/31.325/13.463 ms  </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@xy network-scripts]<span class="comment"># nmcli connection show　 # 管理Network Manager服务</span></span><br><span class="line">  NAME         UUID                                  TYPE            DEVICE        </span><br><span class="line">  eno16777736  e1fa8452-091b-429e-adce-ecea92a845c7  802-3-ethernet  eno16777736   </span><br><span class="line">[root@xy network-scripts]<span class="comment"># nmcli con show eno16777736    </span></span><br><span class="line">  connection.id:                          eno16777736  </span><br><span class="line">  connection.uuid:                        e1fa8452-091b-429e-adce-ecea92a845c7  </span><br><span class="line">  connection.interface-name:  </span><br><span class="line">  ........省略部分输出信息........  </span><br><span class="line">[root@xy ~]<span class="comment"># nmcli connection add con-name company ifname eno16777736</span></span><br><span class="line">  autoconnect   </span><br><span class="line">  no <span class="built_in">type</span> ethernet ip4 192.168.37.10/24 gw4 192.168.37.1  </span><br><span class="line">  Connection <span class="string">&#x27;company&#x27;</span> (a8b3a029-5c7b-4ec7-b519-69f6862e616f) successfully added.</span><br><span class="line">[root@xy ~]<span class="comment"># nmcli connection add con-name house type ethernet ifname eno16777736   </span></span><br><span class="line">  Connection <span class="string">&#x27;house&#x27;</span> (00a825ae-b1c2-4130-a1f6-c693de73783c) successfully added.</span><br><span class="line">[root@xy ~]<span class="comment"># nmcli connection show</span></span><br><span class="line">  NAME         UUID                                  TYPE            DEVICE        </span><br><span class="line">  house        00a825ae-b1c2-4130-a1f6-c693de73783c  802-3-ethernet  --             </span><br><span class="line">  company      a8b3a029-5c7b-4ec7-b519-69f6862e616f  802-3-ethernet  --             </span><br><span class="line">  eno16777736  e1fa8452-091b-429e-adce-ecea92a845c7  802-3-ethernet  eno16777736  </span><br><span class="line">[root@xy ~]<span class="comment"># nmcli connection up house</span></span><br><span class="line">  Connection successfully actived (D-Bus activ path: /org/freedesktop/NetworkManager/ActiveConnection/2)</span><br></pre></td></tr></table></figure>

<h3 id="19-绑定两块网卡"><a href="#19-绑定两块网卡" class="headerlink" title="19. 绑定两块网卡"></a>19. 绑定两块网卡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-eno16777736</span></span><br><span class="line">  TYPE=Ethernet  </span><br><span class="line">  BOOTPROTO=none  </span><br><span class="line">  ONBOOT=yes  </span><br><span class="line">  USERCTL=no  </span><br><span class="line">  DEVICE=eno16777736   </span><br><span class="line">  MASTER=bond0  </span><br><span class="line">  SLAVE=yes  </span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-eno33554984      </span></span><br><span class="line">  TYPE=Ethernet</span><br><span class="line">  BOOTPROTO=none</span><br><span class="line">  ONBOOT=yes</span><br><span class="line">  USERCTL=no</span><br><span class="line">  DEVICE=eno16777736</span><br><span class="line">  MASTER=bond0</span><br><span class="line">  SLAVE=yes  </span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-bond0  </span></span><br><span class="line">  TYPE=Ethernet  </span><br><span class="line">  BOOTPROTO=none  </span><br><span class="line">  ONBOOT=yes  </span><br><span class="line">  USERCTL=no   </span><br><span class="line">  DEVICE=bond0  </span><br><span class="line">  IPADDR=192.168.37.10  </span><br><span class="line">  PREFIX=24  </span><br><span class="line">  DNS=192.168.37.1  </span><br><span class="line">  NM_CONTROLLED=no</span><br></pre></td></tr></table></figure>

<p><strong>常见网卡绑定驱动有三种模式</strong>  </p>
<ul>
<li>mode0:平衡负载模式,平时两块网卡同时工作,且自动备援,但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术  </li>
<li>mode1:自动备援模式,平时仅一块网卡工作,故障后自动替换为另外网卡  </li>
<li>mode6:平衡负载模式,平时两块网卡同时工作,自动备援,无须交换机设备提供辅助支持</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim /etc/modprobe.d/bond.conf　# 创建绑定网卡文件    </span></span><br><span class="line">  <span class="built_in">alias</span> bond0 bonding</span><br><span class="line">  options bond0 miiimon=100 mode=6  </span><br><span class="line">[root@xy ~]<span class="comment"># systemctl restart network  </span></span><br><span class="line">[root@xy ~]<span class="comment"># ifconfig 　 # 正常情况下仅仅bond0网卡设备显示IP等信息  </span></span><br><span class="line">  bond0: flags=5187&lt;UP,BR0ADCAST,RUNNING,MASTER,MULTICAST&gt; mtu 1500  </span><br><span class="line">  inet 192.168.37.10 network 255.255.255.0 broadcast 192.168.37.255  </span><br><span class="line">  inet6 fe80:20c:29ff:fe9c:637d prefixlen 64 scopeid 0x20&lt;link&gt;  </span><br><span class="line">  ........省略部分信息........  </span><br><span class="line">  eno16777736: flags=5187&lt;UP,BR0ADCAST,RUNNING,MASTER,MULTICAST&gt; mtu 1500  </span><br><span class="line">  ........省略部分信息........  </span><br><span class="line">  eno33554984: flags=5187&lt;UP,BR0ADCAST,RUNNING,MASTER,MULTICAST&gt; mtu 1500  </span><br><span class="line">  ........省略部分信息........  </span><br><span class="line">[root@xy ~]<span class="comment"># ping 192.168.37.10 # 断开其中一块网卡,另一块会继续为用户提供服务</span></span><br></pre></td></tr></table></figure>

<h3 id="20-配置sshd服务"><a href="#20-配置sshd服务" class="headerlink" title="20. 配置sshd服务:    "></a>20. 配置sshd服务:    <a id="ssh"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">[root@xy ~]<span class="comment"># systemctl restart sshd　# service sshd start </span></span><br><span class="line">[root@xy ~]<span class="comment"># systemctl enable sshd　 # chkconfig sshd enable  </span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>项目</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Port 22</td>
<td>sshd服务默认端口</td>
</tr>
<tr>
<td>ListenAddress 0.0.0.0</td>
<td>设定sshd服务监听的IP地址</td>
</tr>
<tr>
<td>Protocol 2</td>
<td>SSH协议的版本号</td>
</tr>
<tr>
<td>HostKey /etc/ssh/ssh_host_key</td>
<td>SSH协议的版本1,DES私钥存放位置</td>
</tr>
<tr>
<td>HostKey /etc/ssh/ssh_host_rsa_key</td>
<td>SSH协议的版本2,RSA私钥存放位置</td>
</tr>
<tr>
<td>HostKey /etc/ssh/ssh_host_dsa_key</td>
<td>SSH协议的版本2,DSA私钥存放位置</td>
</tr>
<tr>
<td>PermitRootLogin no</td>
<td>设定是否允许管理员直接登陆</td>
</tr>
<tr>
<td>StrictModes yes</td>
<td>当远程用户的私钥改变时直接拒接登陆</td>
</tr>
<tr>
<td>MaxAuthTries 6</td>
<td>最大密码尝试次数</td>
</tr>
<tr>
<td>MaxSessions 10</td>
<td>最大终端数</td>
</tr>
<tr>
<td>PasswordAuthentication yes</td>
<td>是否允许密码验证</td>
</tr>
<tr>
<td>PermitEmptyPasswords no</td>
<td>是否允许空密码登录</td>
</tr>
</tbody></table>
<p><strong>安全密钥验证</strong><br><em>客户端主机生成“密钥对”(非对称加密)</em>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># ssh-keygen -t rsa -b 2048  # 用此命令的 留下 私钥</span></span><br><span class="line">  Generating public/private rsa key pair. </span><br><span class="line">  Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):　回车或设置密钥存储路径</span><br><span class="line">  Enter passphrase (empty <span class="keyword">for</span> no passphrase): 　直接按回车或设置密钥密码  </span><br><span class="line">  Enter same passphrase again: 再次按回车或设置密钥密码</span><br><span class="line">  Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.  </span><br><span class="line">  Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.  </span><br><span class="line">  The key fingerprint is:  </span><br><span class="line">  81:e1:46:ce:a2:1a:a2:45:e2:5e:46:05:9f:ce:c1:12 root@xy.com  </span><br><span class="line">  The key<span class="string">&#x27;s randomart image is:  </span></span><br><span class="line"><span class="string">  ....</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>客户端主机生成的<code>公钥</code>传送至远程主机上  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># ssh-copy-id 192.168.37.10  # ssh-copy-ip 只能拷贝公钥</span></span><br><span class="line">  Number of key(s) added: 1  </span><br><span class="line">  Now try logging into the machine, with:   <span class="string">&quot;ssh &#x27;192.168.37.10&#x27;&quot;</span>  </span><br><span class="line">  and check to make sure that only the key(s) you wanted were added.  </span><br></pre></td></tr></table></figure>
</li>
<li><p>对服务器进行设置只允许密钥验证  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim /etc/ssh/sshd_config  </span></span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="21-远程传输命令scp-secure-copy-基于SSH协议-Liunx主机之间"><a href="#21-远程传输命令scp-secure-copy-基于SSH协议-Liunx主机之间" class="headerlink" title="21. 远程传输命令scp(secure copy) 基于SSH协议 Liunx主机之间:  "></a>21. 远程传输命令scp(secure copy) 基于SSH协议 Liunx主机之间:  <a id="scp"></a></h3><ul>
<li>scp [参数] 本地文件 远程用户@远程IP地址:远程目录    上传到远程主机</li>
<li>scp [参数] 远程用户@远程IP地址:远程文件 本地目录    下载到本地主机<ul>
<li>-v         显示详细的链接进度</li>
<li>-P         指定远程主机的sshd端口号</li>
<li>-r         用于传送文件</li>
<li>-6         使用ipv6协议</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># echo &quot;Hello World&quot; &gt; readme.txt  </span></span><br><span class="line">[root@xy ~]<span class="comment"># scp /root/readme.txt 192.168.37.10:/home　　　　# 上传</span></span><br><span class="line">[root@xy ~]<span class="comment"># scp 192.168.37.10:/home/readme.txt /root　　　　# 下载</span></span><br></pre></td></tr></table></figure>

<p><strong>不间断会话服务screen</strong>  </p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-ls</td>
<td><strong>显示当前已经有的会话</strong></td>
</tr>
<tr>
<td>-r ID</td>
<td><strong>恢复指定会话</strong></td>
</tr>
<tr>
<td>Ctrl+a,d</td>
<td><strong>剥离当前会话</strong></td>
</tr>
<tr>
<td>-S</td>
<td><strong>创建会话窗口</strong></td>
</tr>
<tr>
<td>-x</td>
<td><strong>加入指定会话</strong></td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># screen -S backup 　 # 屏幕快速闪动进入会话  </span></span><br><span class="line">[root@xy ~]<span class="comment"># screen -ls</span></span><br><span class="line">  There is a screen on:  </span><br><span class="line">        3127.backup     (Attached)  </span><br><span class="line">1 Socket <span class="keyword">in</span> /var/run/screen/S-root.</span><br></pre></td></tr></table></figure>

<h3 id="22-Apache-服务部署静态网站"><a href="#22-Apache-服务部署静态网站" class="headerlink" title="22. Apache 服务部署静态网站  "></a>22. Apache 服务部署静态网站  <a id="apache"></a></h3><ul>
<li>Web 服务程序:IIS、Nginx、Apache  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># yum install httpd</span></span><br><span class="line">[root@xy ~]<span class="comment"># systemctl start httpd  </span></span><br><span class="line">[root@xy ~]<span class="comment"># systemctl enable httpd</span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/httpd/conf/httpd.conf # 配置文件</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="22-1-httpd服务程序配置文件及存放位置"><a href="#22-1-httpd服务程序配置文件及存放位置" class="headerlink" title="22.1 httpd服务程序配置文件及存放位置"></a>22.1 httpd服务程序配置文件及存放位置</h4><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>服务目录</td>
<td>/etc/httpd</td>
</tr>
<tr>
<td>主配置文件</td>
<td>/etc/httpd/conf/httpd.conf</td>
</tr>
<tr>
<td>网站数据目录DocumentRoot</td>
<td>/var/www/html</td>
</tr>
<tr>
<td>访问日志</td>
<td>/var/log/httpd/access_log</td>
</tr>
<tr>
<td>错误日志</td>
<td>/var/log/httpd/error_log</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ServerRoot</td>
<td>服务目录  ✔</td>
</tr>
<tr>
<td>ServerAdmin</td>
<td>管理员邮箱</td>
</tr>
<tr>
<td>User</td>
<td>运行服务的用户</td>
</tr>
<tr>
<td>Group</td>
<td>运行服务的用户组</td>
</tr>
<tr>
<td>ServerName</td>
<td>网站服务器的域名</td>
</tr>
<tr>
<td>DocumentRoot</td>
<td>网站数据目录  ✔</td>
</tr>
<tr>
<td>Directory</td>
<td>网站数据目录的权限</td>
</tr>
<tr>
<td>DirectoryIndex</td>
<td>默认索引页面  ✔</td>
</tr>
<tr>
<td>ErrorLog</td>
<td>错误日志文件</td>
</tr>
<tr>
<td>CustomLog</td>
<td>访问日志文件</td>
</tr>
<tr>
<td>Timeout</td>
<td>网页超时时间,默认300s</td>
</tr>
</tbody></table>
<blockquote>
<p>SELinux(Security-Enhances Linux),强制反问控制(MAC)安全子系统,三种服务配置模式<code>enforccing  peimissing  disabled</code>,当改变DocumentRoot路径后,违反了SELinux监管规则,所以在新的路径下Index.html无法访问；</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim  /etc/selinux/config　  # SELinux 配置文件路径</span></span><br><span class="line">  1  <span class="comment">#This file controls the state of SELinux on the system.  </span></span><br><span class="line">  2  <span class="comment"># SELINUX= can take one of these three values:  </span></span><br><span class="line">  3  <span class="comment">#     enforcing - SELinux security policy is enforced.   &#x27;enforce&#x27;  </span></span><br><span class="line">  4  <span class="comment">#     permissive - SELinux prints warnings instead of enforcing.  &#x27;permissive&#x27;  </span></span><br><span class="line">  5  <span class="comment">#     disabled - No SELinux policy is loaded.  &#x27;disabled SELINUX=enforcing  </span></span><br><span class="line">  6  <span class="comment"># SELINUXTYPE= can take one of these two values:  </span></span><br><span class="line">  7  <span class="comment">#     targeted - Targeted processes are protected,  </span></span><br><span class="line">  8  <span class="comment">#     minimum - Modification of targeted policy. Only selected processes are protected.   </span></span><br><span class="line">  9  <span class="comment">#     mls - Multi Level Security protection.</span></span><br></pre></td></tr></table></figure>

<h4 id="22-2-SELinux-安全上下文由用户段、角色段、类型段共同组成"><a href="#22-2-SELinux-安全上下文由用户段、角色段、类型段共同组成" class="headerlink" title="22.2 SELinux 安全上下文由用户段、角色段、类型段共同组成"></a>22.2 SELinux 安全上下文由用户段、角色段、类型段共同组成</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># setenforce 0   # setenforce  </span></span><br><span class="line">[root@xy ~]<span class="comment"># getenforce 　  # getenforce  </span></span><br><span class="line">  Permissive  </span><br><span class="line">[root@xy ~]<span class="comment"># setenforce 1    </span></span><br><span class="line">[root@xy ~]<span class="comment"># getenforce </span></span><br><span class="line">  Enforcing  </span><br><span class="line">[root@xy ~]<span class="comment"># ls -Zd /var/www/html/ 　# ls -Zd  用户段 角色段 类型段  </span></span><br><span class="line">  drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/html/  </span><br><span class="line">[root@xy ~]<span class="comment"># ls -Zd /home/wwwroot/</span></span><br><span class="line">  drwxr-xr-x. root root unconfined_u:object_r:home_root_t:s0 /home/wwwroot/</span><br></pre></td></tr></table></figure>

<h4 id="22-3-semanage-参数-选项-文件"><a href="#22-3-semanage-参数-选项-文件" class="headerlink" title="22.3 semanage [参数] [选项] [文件]"></a>22.3 semanage [参数] [选项] [文件]</h4><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-l</td>
<td>用于查询</td>
</tr>
<tr>
<td>-a</td>
<td>用于添加</td>
</tr>
<tr>
<td>-m</td>
<td>用于修改</td>
</tr>
<tr>
<td>-d</td>
<td>用于删除</td>
</tr>
<tr>
<td>semanage fcontext -a -t</td>
<td>用于添加新的SELinux安全上下文✔</td>
</tr>
<tr>
<td>restorcon -Rv</td>
<td>更新安全上下文</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot   </span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/*  </span></span><br><span class="line">[root@xy ~]<span class="comment"># restorecon -Rv /home/wwwroot/    </span></span><br><span class="line">  restorecon reset /home/wwwroot context unconfined_u:object_r:home_root_t:s0-&gt;  </span><br><span class="line">  unconfined_u:object_r:httpd_sys_content_t:s0  </span><br><span class="line">  restorecon reset /home/wwwroot/index.html context   </span><br><span class="line">  unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0</span><br></pre></td></tr></table></figure>

<h4 id="22-4-个人用户主页功能"><a href="#22-4-个人用户主页功能" class="headerlink" title="22.4 个人用户主页功能"></a>22.4 个人用户主页功能</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim /etc/httpd/conf.d/userdir.conf</span></span><br><span class="line">  <span class="comment">#UserDir disabled  </span></span><br><span class="line">  UserDir public_html　　24行 去掉<span class="comment">#   网站在用户家目录中保存的名称 </span></span><br><span class="line">[root@xy ~]<span class="comment"># su - xy  </span></span><br><span class="line">[xy@xy ~]$ mkdir public_html  </span><br><span class="line">[xy@xy ~]$ <span class="built_in">echo</span> <span class="string">&quot;This is xy&#x27;s website&quot;</span> &gt; public_html/index.html </span><br><span class="line">[xy@xy ~]$ chmod -Rf 755 /home/xy</span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># getsebool -a | grep http　# getsebool -a 获取安全策略  </span></span><br><span class="line">  httpd_enable_homedirs --&gt; off  </span><br><span class="line">[root@xy ~]<span class="comment"># setsebool -P httpd_enable_homedirs=on　 # setsebool -P  </span></span><br><span class="line">[root@xy ~]<span class="comment"># htpasswd -c /etc/httpd/passwd xy </span></span><br><span class="line">  New password:  </span><br><span class="line">  Re-type new password:  </span><br><span class="line">  Adding password <span class="keyword">for</span> user xy  </span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/httpd/conf.d/userdir.conf  # 31-35 </span></span><br><span class="line">  &lt;Directory <span class="string">&quot;/home/*/public_html&quot;</span>&gt;  </span><br><span class="line">     AllowOverride all  </span><br><span class="line">     authuserfile <span class="string">&quot;/etc/httpd/passwd&quot;</span>  </span><br><span class="line">     authname <span class="string">&quot;My privately website&quot;</span>  </span><br><span class="line">     authtype basic  </span><br><span class="line">     require user xy  </span><br><span class="line">  &lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<h4 id="22-5-虚拟主机-VPS-Virtual-Private-Server-功能"><a href="#22-5-虚拟主机-VPS-Virtual-Private-Server-功能" class="headerlink" title="22.5 虚拟主机(VPS:Virtual Private Server)功能"></a>22.5 虚拟主机(VPS:Virtual Private Server)功能</h4><p><strong>利用该功能可以把一台物理服务器分割为多个”虚拟服务器”,VPS共享物理服务器硬件</strong><br><strong>资源,Apache的VPS是基于用户请求不同IP、主机域名、端口号,实现提供多个网站同时为外部提供访问服务技术</strong>   </p>
<h5 id="1-基于多个IP地址-192-168-37-10-192-168-37-20-192-168-37-30"><a href="#1-基于多个IP地址-192-168-37-10-192-168-37-20-192-168-37-30" class="headerlink" title="1. 基于多个IP地址(192.168.37.10 ; 192.168.37.20 ; 192.168.37.30)"></a>1. 基于多个IP地址(192.168.37.10 ; 192.168.37.20 ; 192.168.37.30)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkdir -p /home/wwwroot/10  </span></span><br><span class="line">[root@xy ~]<span class="comment"># echo &quot;IP:192.168.37.10&quot; &gt; /home/wwwroot/10/index.html  </span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/httpd/conf/httpd.conf       </span></span><br><span class="line">  &lt;VirtualHost 192.168.37.10&gt;  </span><br><span class="line">  &lt;DocumentRoot <span class="string">&quot;/home/wwwroot/10&quot;</span>&gt;  </span><br><span class="line">    ServerName tech.xy.com  </span><br><span class="line">  &lt;Directory <span class="string">&quot;/home/wwwroot/10&quot;</span>&gt;  </span><br><span class="line">    AllowOverride None  </span><br><span class="line">    Require all granted  </span><br><span class="line">  &lt;/Directory&gt;  </span><br><span class="line">  &lt;/VirtualHost&gt; </span><br></pre></td></tr></table></figure>

<h5 id="2-基于主机域名-192-168-37-10-www-xy-com-bbs-xy-com-tech-xy-com-●ˇ∀ˇ●"><a href="#2-基于主机域名-192-168-37-10-www-xy-com-bbs-xy-com-tech-xy-com-●ˇ∀ˇ●" class="headerlink" title="2. 基于主机域名(192.168.37.10 www.xy.com bbs.xy.com tech.xy.com)  (●ˇ∀ˇ●)"></a>2. 基于主机域名(192.168.37.10 <a target="_blank" rel="noopener" href="http://www.xy.com/">www.xy.com</a> bbs.xy.com tech.xy.com)  (●ˇ∀ˇ●)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># vim /etc/hosts     </span></span><br><span class="line">  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4  </span><br><span class="line">  ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6  </span><br><span class="line">  192.168.37.10 www.xy.com bbs.xy.com tech.xy.com  </span><br><span class="line">[root@xy ~]<span class="comment"># mkdir -p /home/wwwroot/www</span></span><br><span class="line">  &lt;VirtualHost 192.168.37.10&gt;  </span><br><span class="line">  DocumentRoot <span class="string">&quot;/home/wwwroot/www&quot;</span>  </span><br><span class="line">  ServerName tech.xy.com  </span><br><span class="line">  &lt;Directory <span class="string">&quot;/home/wwwroot/www&quot;</span>&gt;  </span><br><span class="line">	AllowOverride None  </span><br><span class="line">	Require all granted  </span><br><span class="line">  &lt;/Directory&gt;  </span><br><span class="line">  &lt;/VirtualHost&gt; </span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># systemctl restart httpd</span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/ </span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/bbs </span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/bbs/*</span></span><br><span class="line">[root@xy ~]<span class="comment"># restorecon -Rv /home/wwwroot</span></span><br></pre></td></tr></table></figure>

<h5 id="3-基于端口号80-443-8080比较合理-测试-6111-6222"><a href="#3-基于端口号80-443-8080比较合理-测试-6111-6222" class="headerlink" title="3. 基于端口号80 443 8080比较合理  (测试:6111 6222)"></a>3. 基于端口号80 443 8080比较合理  (测试:6111 6222)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@xy ~]<span class="comment"># mkdir -p /home/wwwroot/6111</span></span><br><span class="line">[root@xy ~]<span class="comment"># echo &quot;port:6111&quot; &gt; /home/wwwroot/6111/index.html</span></span><br><span class="line">[root@xy ~]<span class="comment"># vim /etc/httpd/conf/httpd.conf </span></span><br><span class="line">  Listen 6111  </span><br><span class="line">    &lt;VirtualHost 192.168.37.10:6111&gt;  </span><br><span class="line">    DocumentRoot <span class="string">&quot;/home/wwwroot/6111&quot;</span>  </span><br><span class="line">    ServerName www.xy.com  </span><br><span class="line">    &lt;Directory <span class="string">&quot;/home/wwwroot/6111&quot;</span>&gt;  </span><br><span class="line">        AllowOverride None  </span><br><span class="line">        Require all granted  </span><br><span class="line">    &lt;/Directory&gt;  </span><br><span class="line">    &lt;/VirtualHost&gt;    </span><br><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot </span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111 </span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111/*  </span></span><br><span class="line">[root@xy ~]<span class="comment"># restorecon -Rv /home/wwwroot </span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage port -l | grep http   # semanage port -l 查询端口</span></span><br><span class="line">    http_cache_port_t            tcp      8080, 8118, 8123, 10001-10010  </span><br><span class="line">    http_cache_port_t            udp      3130  </span><br><span class="line">    http_port_t                  tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000  </span><br><span class="line">    pegasus_http_port_t          tcp      5988  </span><br><span class="line">    pegasus_https_port_t         tcp      5989  </span><br><span class="line"></span><br><span class="line">[root@xy ~]<span class="comment"># semanage port -a -t http_port_t -p tcp 6111  # semanage port -a -t  </span></span><br><span class="line">[root@xy ~]<span class="comment"># semanage port -l | grep http</span></span><br><span class="line">    http_cache_port_t    tcp   8080, 8118, 8123, 10001-10010  </span><br><span class="line">    http_cache_port_t    udp   3130  </span><br><span class="line">    http_port_t          tcp   6111, 80, 81, 443, 488, 8008, 8009, 8443, 9000  </span><br><span class="line">    pegasus_http_port_t  tcp   5988  </span><br><span class="line">    pegasus_https_port_t tcp   5989  </span><br><span class="line">[root@xy ~]<span class="comment"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure>

<h4 id="22-6-构建基于HTTP的网络YUM源"><a href="#22-6-构建基于HTTP的网络YUM源" class="headerlink" title="22.6 构建基于HTTP的网络YUM源"></a>22.6 构建基于HTTP的网络YUM源</h4><ol>
<li>挂在光盘镜像并拷贝光盘下Packages目录所有软件包到 /var/www/html/centos;  </li>
<li>创建本地源，构建缓存，<code>yum install createrepo; createrepo centos/</code>;</li>
<li>安装httpd并<code>useradd apache -g apache</code>，重启服务并关闭防火墙;</li>
<li>配置网络yum源/etc/yum.repo.d/http.repo:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[base]</span><br><span class="line">name = <span class="string">&quot;CentOS7 HTTP YUM&quot;</span></span><br><span class="line">baseurl = http://192.168.37.10/centos/</span><br><span class="line">gpgcheck = 0</span><br><span class="line">enabled = 1</span><br><span class="line">[update]</span><br><span class="line">name = <span class="string">&quot;CentOS7 HTTP YUM&quot;</span></span><br><span class="line">baseurl = http://192.168.37.10/centos/</span><br><span class="line">gpgcheck = 0</span><br><span class="line">enabled = 1</span><br></pre></td></tr></table></figure></li>
<li>更新软件包，<code>createrepo --update centos/</code>   </li>
<li>同步外网YUM源reposync:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repo.d/ http://mirrors.163.com/.<span class="built_in">help</span>/CentOS7-Base-163.repo </span><br><span class="line">yum install yum-utils createrepo -y</span><br><span class="line">yum repolist</span><br><span class="line">reposync -r base -p /var/www/html/centos</span><br><span class="line">createrepo /var/www/html/centos</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="返回目录"><a href="#返回目录" class="headerlink" title="返回目录"></a><a href="#back" target="_self">返回目录</a></h4>
    </div>

    
    
    
        <div class="reward-container">
  <div>如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="anyue967 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="anyue967 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>anyue967
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://anyue967.github.io/posts/296e7ad4.html" title="Linux服务配置01">https://anyue967.github.io/posts/296e7ad4.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

      
      
      
        <div>
          <div>
    
    	<div style="text-align:center;color: #1E1E1E;font-size:16px;line-height: 4;">------本文结束
        <i class="fa fa-paw"></i>感谢阅读------
        </div>
    
</div>
        </div>
      

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"><i class="fa fa-tag"></i> linux</a>
              <a href="/tags/Devops/" rel="tag"><i class="fa fa-tag"></i> Devops</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/4ac0a166.html" rel="prev" title="Linux基础命令">
      <i class="fa fa-chevron-left"></i> Linux基础命令
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/c7601bf8.html" rel="next" title="Linux服务配置03">
      Linux服务配置03 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text">目录    </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%80%E5%88%87%E4%BB%8E-%E5%BC%80%E5%A7%8B"><span class="nav-number">1.1.</span> <span class="nav-text">1. 一切从  &#x2F; 开始</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%B7%AF%E5%BE%84"><span class="nav-number">1.2.</span> <span class="nav-text">2. 路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%89%A9%E7%90%86%E8%AE%BE%E5%A4%87%E7%9A%84%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="nav-number">1.3.</span> <span class="nav-text">3. 物理设备的命名规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%B5%84%E6%96%99"><span class="nav-number">1.4.</span> <span class="nav-text">4. 文件系统与数据资料</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%8C%82%E8%BD%BD%E7%A1%AC%E4%BB%B6%E8%AE%BE%E5%A4%87"><span class="nav-number">1.5.</span> <span class="nav-text">5. 挂载硬件设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%92%A4%E9%94%80%E6%8C%82%E8%BD%BD%E8%AE%BE%E5%A4%87"><span class="nav-number">1.6.</span> <span class="nav-text">6. 撤销挂载设备  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%88%86%E5%8C%BA-%E6%A0%BC%E5%BC%8F%E5%8C%96-%E6%8C%82%E8%BD%BD"><span class="nav-number">1.7.</span> <span class="nav-text">7. 分区-格式化-挂载:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#fdisk"><span class="nav-number">1.7.1.</span> <span class="nav-text">fdisk</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-%E5%88%86%E5%8C%BA%EF%BC%9A"><span class="nav-number">1.7.2.</span> <span class="nav-text">7.1 分区：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-%E6%A0%BC%E5%BC%8F%E5%8C%96-%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%9E%8B-%EF%BC%9A-mkfs-%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E5%90%8D%E7%A7%B0-dev-sdb1"><span class="nav-number">1.7.3.</span> <span class="nav-text">7.2 格式化(创建文件系统类型)： mkfs.文件类型名称 &#x2F;dev&#x2F;sdb1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-%E6%8C%82%E8%BD%BD%E5%88%86%E5%8C%BA%EF%BC%9A"><span class="nav-number">1.7.4.</span> <span class="nav-text">7.3 挂载分区：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E6%B7%BB%E5%8A%A0%E4%BA%A4%E6%8D%A2%E5%88%86%E5%8C%BAswap"><span class="nav-number">1.8.</span> <span class="nav-text">8. 添加交换分区swap</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-%E5%88%86%E5%8C%BA%EF%BC%9A"><span class="nav-number">1.8.1.</span> <span class="nav-text">8.1 分区：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-%E6%A0%BC%E5%BC%8F%E5%8C%96%EF%BC%9A"><span class="nav-number">1.8.2.</span> <span class="nav-text">8.2 格式化：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-%E6%8C%82%E8%BD%BD%E5%88%86%E5%8C%BA%EF%BC%9A"><span class="nav-number">1.8.3.</span> <span class="nav-text">8.3 挂载分区：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%88%A0%E9%99%A4%E6%89%8B%E5%8A%A8%E5%A2%9E%E5%8A%A0%E7%9A%84%E4%BA%A4%E6%8D%A2%E5%88%86%E5%8C%BAswap"><span class="nav-number">1.9.</span> <span class="nav-text">9. 删除手动增加的交换分区swap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E7%A3%81%E7%9B%98%E5%AE%B9%E9%87%8F%E9%85%8D%E9%A2%9D%E6%8A%80%E6%9C%AF"><span class="nav-number">1.10.</span> <span class="nav-text">10. 磁盘容量配额技术  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E5%88%9B%E5%BB%BA%E9%93%BE%E6%8E%A5%E6%96%87%E4%BB%B6ln"><span class="nav-number">1.11.</span> <span class="nav-text">11. 创建链接文件ln</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-RAID%E4%B8%8ELVM%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97%E6%8A%80%E6%9C%AF"><span class="nav-number">1.12.</span> <span class="nav-text">12. RAID与LVM磁盘阵列技术  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-%E9%83%A8%E7%BD%B2%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97RAID-5-%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%8B%BF%E5%88%86%E5%8C%BA%E5%81%9A%E5%AE%9E%E9%AA%8C"><span class="nav-number">1.13.</span> <span class="nav-text">12.1 部署磁盘阵列RAID 5(也可以拿分区做实验)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BARAID-5%EF%BC%9A"><span class="nav-number">1.13.1.</span> <span class="nav-text">1)创建RAID 5：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%9F%A5%E7%9C%8BRAID-5%EF%BC%9A"><span class="nav-number">1.13.2.</span> <span class="nav-text">2)查看RAID 5：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%A0%BC%E5%BC%8F%E5%8C%96RAID-5%EF%BC%9A"><span class="nav-number">1.13.3.</span> <span class="nav-text">3)格式化RAID 5：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%8C%82%E8%BD%BD-RAID-5"><span class="nav-number">1.13.4.</span> <span class="nav-text">4)挂载 RAID 5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-3-%E9%83%A8%E7%BD%B2%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97RAID-10"><span class="nav-number">1.13.5.</span> <span class="nav-text">12.3 部署磁盘阵列RAID 10:</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA-RAID-10"><span class="nav-number">1.13.5.1.</span> <span class="nav-text">1) 创建 RAID 10:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E6%A0%BC%E5%BC%8F%E5%8C%96-RAID-10"><span class="nav-number">1.13.5.2.</span> <span class="nav-text">2) 格式化 RAID 10:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%8C%82%E8%BD%BD-RAID-10"><span class="nav-number">1.13.5.3.</span> <span class="nav-text">3) 挂载 RAID 10:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E6%9F%A5%E7%9C%8B-RAID-10-%E4%BF%A1%E6%81%AF"><span class="nav-number">1.13.5.4.</span> <span class="nav-text">4) 查看 RAID 10 信息:</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-2-%E6%A8%A1%E6%8B%9F%E6%8D%9F%E5%9D%8F%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97%E5%8F%8A%E4%BF%AE%E5%A4%8D%EF%BC%9A"><span class="nav-number">1.13.6.</span> <span class="nav-text">12.2 模拟损坏磁盘阵列及修复：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-LVM-8e-Logical-Volume-Manager%EF%BC%8C%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">1.14.</span> <span class="nav-text">13. LVM(8e) (Logical Volume Manager，逻辑卷管理器)  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#13-1-%E5%B8%B8%E7%94%A8LVM%E9%83%A8%E7%BD%B2%E5%91%BD%E4%BB%A4"><span class="nav-number">1.14.1.</span> <span class="nav-text">13.1 常用LVM部署命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-2-%E5%88%9B%E5%BB%BALVM-PV-gt-VG-gt-LV-gt-mkfs-ext4-dev-storage-vo-gt-monut"><span class="nav-number">1.14.2.</span> <span class="nav-text">13.2 创建LVM: PV -&gt; VG -&gt; LV -&gt; mkfs.ext4 &#x2F;dev&#x2F;storage&#x2F;vo -&gt; monut</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-pvcrate-%E5%88%9B%E5%BB%BA%E7%89%A9%E7%90%86%E5%8D%B7%EF%BC%9A"><span class="nav-number">1.14.2.1.</span> <span class="nav-text">1) pvcrate 创建物理卷：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-vgcrate-%E5%88%9B%E5%BB%BA%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86%EF%BC%9A"><span class="nav-number">1.14.2.2.</span> <span class="nav-text">2) vgcrate 创建卷组管理：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-vgdisplay-%E6%98%BE%E7%A4%BA%E5%8D%B7%E7%BB%84%E7%AE%A1%E7%90%86%EF%BC%9A"><span class="nav-number">1.14.2.3.</span> <span class="nav-text">3) vgdisplay 显示卷组管理：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-lvcrate-%E5%88%9B%E5%BB%BA%E9%80%BB%E8%BE%91%E5%8D%B7%EF%BC%9A"><span class="nav-number">1.14.2.4.</span> <span class="nav-text">4) lvcrate 创建逻辑卷：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-lvdisplay-%E6%98%BE%E7%A4%BA%E9%80%BB%E8%BE%91%E5%8D%B7%EF%BC%9A"><span class="nav-number">1.14.2.5.</span> <span class="nav-text">5) lvdisplay 显示逻辑卷：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%80%BB%E8%BE%91%E5%8D%B7%EF%BC%9A"><span class="nav-number">1.14.2.6.</span> <span class="nav-text">6) 格式化逻辑卷：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-%E6%8C%82%E8%BD%BD%E4%BD%BF%E7%94%A8%E9%80%BB%E8%BE%91%E5%8D%B7%EF%BC%9A"><span class="nav-number">1.14.2.7.</span> <span class="nav-text">7) 挂载使用逻辑卷：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-%E6%89%A9%E5%AE%B9"><span class="nav-number">1.14.2.8.</span> <span class="nav-text">8) 扩容</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7-%E7%B1%BB%E4%BC%BC%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BF%AB%E7%85%A7-%E7%89%B9%E7%82%B9-%E5%BF%AB%E7%85%A7%E5%8D%B7%E5%AE%B9%E9%87%8F%E5%BF%85%E9%A1%BB%E7%AD%89%E5%90%8C%E4%BA%8E%E9%80%BB%E8%BE%91%E5%8D%B7%E5%AE%B9%E9%87%8F-%E5%BF%AB%E7%85%A7%E5%8D%B7%E6%98%AF%E4%B8%80%E6%AC%A1%E6%80%A7%E7%9A%84-%E6%89%A7%E8%A1%8C%E5%90%8E%E4%BC%9A%E7%AB%8B%E5%8D%B3%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4"><span class="nav-number">1.15.</span> <span class="nav-text">14. 逻辑卷快照:类似于虚拟机快照, 特点:快照卷容量必须等同于逻辑卷容量; 快照卷是一次性的, 执行后会立即自动删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-%E5%88%A0%E9%99%A4%E9%80%BB%E8%BE%91%E5%8D%B7-LV-gt-VG-gt-PV"><span class="nav-number">1.16.</span> <span class="nav-text">15. 删除逻辑卷: LV -&gt; VG -&gt; PV</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-iptables-%E4%B8%8E-firewalld-%E9%98%B2%E7%81%AB%E5%A2%99-%E5%9B%9B%E8%A1%A8%E4%BA%94%E9%93%BE"><span class="nav-number">1.17.</span> <span class="nav-text">16. iptables 与 firewalld 防火墙(四表五链)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#16-1-iptables%E5%91%BD%E4%BB%A4-%E5%8F%82%E6%95%B0-%E7%AD%96%E7%95%A5%E8%A7%84%E5%88%99%E9%93%BE-%E5%8A%A8%E4%BD%9C-%EF%BC%9A"><span class="nav-number">1.17.1.</span> <span class="nav-text">16.1 iptables命令  参数 + 策略规则链 + 动作 ：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-2-%E7%AD%96%E7%95%A5%E8%A7%84%E5%88%99%E9%93%BE-iptables-%E6%9C%8D%E5%8A%A1%E6%8A%8A%E7%94%A8%E4%BA%8E%E5%A4%84%E7%90%86%E6%88%96%E8%BF%87%E6%BB%A4%E6%B5%81%E9%87%8F%E7%9A%84%E7%AD%96%E7%95%A5%E6%9D%A1%E7%9B%AE%E7%A7%B0%E4%B8%BA%E8%A7%84%E5%88%99-%E5%A4%9A%E6%9D%A1%E8%A7%84%E5%88%99%E5%8F%AF%E7%BB%84%E6%88%90%E4%B8%80%E4%B8%AA%E8%A7%84%E5%88%99%E9%93%BE-%E8%80%8C%E8%A7%84%E5%88%99%E9%93%BE%E5%88%99%E4%BE%9D%E6%8D%AE%E6%95%B0%E6%8D%AE%E5%8C%85%E5%A4%84%E7%90%86%E4%BD%8D%E7%BD%AE%E7%9A%84%E4%B8%8D%E5%90%8C%E8%BF%9B%E8%A1%8C%E5%88%86%E7%B1%BB-%E5%85%B7%E4%BD%93%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="nav-number">1.17.2.</span> <span class="nav-text">16.2 策略规则链[iptables]服务把用于处理或过滤流量的策略条目称为规则,多条规则可组成一个规则链,而规则链则依据数据包处理位置的不同进行分类,具体如下：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-4-%E4%BB%85%E5%85%81%E8%AE%B8%E6%8C%87%E5%AE%9A%E7%BD%91%E6%AE%B5%E7%9A%84%E4%B8%BB%E6%9C%BA%E8%AE%BF%E9%97%AE%E6%9C%AC%E6%9C%BA%E7%9A%8422%E7%AB%AF%E5%8F%A3-SSH"><span class="nav-number">1.17.3.</span> <span class="nav-text">16.4 仅允许指定网段的主机访问本机的22端口 SSH</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-5-INPUT-%E8%A7%84%E5%88%99%E9%93%BE%E5%8A%A0%E5%85%A5%E6%8B%92%E7%BB%9D%E6%89%80%E6%9C%89%E4%BA%BA%E8%AE%BF%E9%97%AE%E6%9C%AC%E6%9C%BA12345%E7%AB%AF%E5%8F%A3%E7%9A%84%E7%AD%96%E7%95%A5%E8%A7%84%E5%88%99"><span class="nav-number">1.17.4.</span> <span class="nav-text">16.5 INPUT 规则链加入拒绝所有人访问本机12345端口的策略规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-6-INPUT-%E8%A7%84%E5%88%99%E9%93%BE%E5%8A%A0%E5%85%A5%E6%8B%92%E7%BB%9D%E6%89%80%E6%9C%89%E4%BA%BA%E8%AE%BF%E9%97%AE%E6%9C%AC%E6%9C%BA1000-1024%E7%AB%AF%E5%8F%A3%E7%9A%84%E7%AD%96%E7%95%A5%E8%A7%84%E5%88%99"><span class="nav-number">1.17.5.</span> <span class="nav-text">16.6 INPUT 规则链加入拒绝所有人访问本机1000:1024端口的策略规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-7-INPUT-%E8%A7%84%E5%88%99%E9%93%BE%E5%8A%A0%E5%85%A5%E6%8B%92%E7%BB%9D192-168-37-5%E8%AE%BF%E9%97%AE%E6%9C%AC%E6%9C%BA80%E7%AB%AF%E5%8F%A3%E7%9A%84%E7%AD%96%E7%95%A5%E8%A7%84%E5%88%99"><span class="nav-number">1.17.6.</span> <span class="nav-text">16.7 INPUT 规则链加入拒绝192.168.37.5访问本机80端口的策略规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-8-%E7%A6%81%E6%AD%A2%E6%BA%90%E8%87%AA192-168-10-0-24-%E7%BD%91%E6%AE%B5%E7%9A%84%E6%B5%81%E9%87%8F%E8%AE%BF%E9%97%AE%E6%9C%AC%E6%9C%BAsshd%E6%9C%8D%E5%8A%A1%EF%BC%9A"><span class="nav-number">1.17.7.</span> <span class="nav-text">16.8 禁止源自192.168.10.0&#x2F;24 网段的流量访问本机sshd服务：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-9-SNAT-amp-amp-DNAT"><span class="nav-number">1.17.8.</span> <span class="nav-text">16.9 SNAT &amp;&amp; DNAT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-10-SNAT-%E8%BD%AC%E6%8D%A2%E8%A7%84%E5%88%99%EF%BC%9A%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE%E5%A4%96%E7%BD%91-%E8%B7%AF%E7%94%B1%E5%90%8E%E4%BA%A4%E7%BB%99SNAT"><span class="nav-number">1.17.9.</span> <span class="nav-text">16.10 SNAT 转换规则：内网访问外网(路由后交给SNAT)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-11-DNAT-%E8%BD%AC%E6%8D%A2%E8%A7%84%E5%88%99%EF%BC%9A%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AE%E5%86%85%E7%BD%91-%E8%B7%AF%E7%94%B1%E5%89%8D%E4%BA%A4%E7%BB%99DNAT"><span class="nav-number">1.17.10.</span> <span class="nav-text">16.11 DNAT 转换规则：外网访问内网(路由前交给DNAT)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-12-%E8%A7%A3%E5%86%B3Windows%E8%AE%BF%E9%97%AESamba%E6%9C%8D%E5%8A%A1%E6%8B%92%E7%BB%9D%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.17.11.</span> <span class="nav-text">16.12 解决Windows访问Samba服务拒绝的方法:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-firewalld-Dynamic-Firewall-Manager-of-Linux-system-Linux%E5%8A%A8%E6%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">1.18.</span> <span class="nav-text">17 firewalld(Dynamic Firewall Manager of Linux system):Linux动态防火墙管理器 </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#17-1-firewalld%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8C%BA%E5%9F%9F%E5%90%8D%E5%8F%8A%E7%AD%96%E7%95%A5%E8%A7%84%E5%88%99"><span class="nav-number">1.18.1.</span> <span class="nav-text">17.1 firewalld中常用的区域名及策略规则:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-2-firewall-cmd-%E5%91%BD%E4%BB%A4"><span class="nav-number">1.18.2.</span> <span class="nav-text">17.2 firewall-cmd 命令:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-%E4%BD%BF%E7%94%A8SSH%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA"><span class="nav-number">1.19.</span> <span class="nav-text">18. 使用SSH服务管理远程主机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-%E7%BB%91%E5%AE%9A%E4%B8%A4%E5%9D%97%E7%BD%91%E5%8D%A1"><span class="nav-number">1.20.</span> <span class="nav-text">19. 绑定两块网卡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-%E9%85%8D%E7%BD%AEsshd%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.21.</span> <span class="nav-text">20. 配置sshd服务:    </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-%E8%BF%9C%E7%A8%8B%E4%BC%A0%E8%BE%93%E5%91%BD%E4%BB%A4scp-secure-copy-%E5%9F%BA%E4%BA%8ESSH%E5%8D%8F%E8%AE%AE-Liunx%E4%B8%BB%E6%9C%BA%E4%B9%8B%E9%97%B4"><span class="nav-number">1.22.</span> <span class="nav-text">21. 远程传输命令scp(secure copy) 基于SSH协议 Liunx主机之间:  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-Apache-%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99"><span class="nav-number">1.23.</span> <span class="nav-text">22. Apache 服务部署静态网站  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#22-1-httpd%E6%9C%8D%E5%8A%A1%E7%A8%8B%E5%BA%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%8A%E5%AD%98%E6%94%BE%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.23.1.</span> <span class="nav-text">22.1 httpd服务程序配置文件及存放位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-2-SELinux-%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E7%94%B1%E7%94%A8%E6%88%B7%E6%AE%B5%E3%80%81%E8%A7%92%E8%89%B2%E6%AE%B5%E3%80%81%E7%B1%BB%E5%9E%8B%E6%AE%B5%E5%85%B1%E5%90%8C%E7%BB%84%E6%88%90"><span class="nav-number">1.23.2.</span> <span class="nav-text">22.2 SELinux 安全上下文由用户段、角色段、类型段共同组成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-3-semanage-%E5%8F%82%E6%95%B0-%E9%80%89%E9%A1%B9-%E6%96%87%E4%BB%B6"><span class="nav-number">1.23.3.</span> <span class="nav-text">22.3 semanage [参数] [选项] [文件]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-4-%E4%B8%AA%E4%BA%BA%E7%94%A8%E6%88%B7%E4%B8%BB%E9%A1%B5%E5%8A%9F%E8%83%BD"><span class="nav-number">1.23.4.</span> <span class="nav-text">22.4 个人用户主页功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-5-%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA-VPS-Virtual-Private-Server-%E5%8A%9F%E8%83%BD"><span class="nav-number">1.23.5.</span> <span class="nav-text">22.5 虚拟主机(VPS:Virtual Private Server)功能</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%9F%BA%E4%BA%8E%E5%A4%9A%E4%B8%AAIP%E5%9C%B0%E5%9D%80-192-168-37-10-192-168-37-20-192-168-37-30"><span class="nav-number">1.23.5.1.</span> <span class="nav-text">1. 基于多个IP地址(192.168.37.10 ; 192.168.37.20 ; 192.168.37.30)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%9F%BA%E4%BA%8E%E4%B8%BB%E6%9C%BA%E5%9F%9F%E5%90%8D-192-168-37-10-www-xy-com-bbs-xy-com-tech-xy-com-%E2%97%8F%CB%87%E2%88%80%CB%87%E2%97%8F"><span class="nav-number">1.23.5.2.</span> <span class="nav-text">2. 基于主机域名(192.168.37.10 www.xy.com bbs.xy.com tech.xy.com)  (●ˇ∀ˇ●)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E5%8F%B780-443-8080%E6%AF%94%E8%BE%83%E5%90%88%E7%90%86-%E6%B5%8B%E8%AF%95-6111-6222"><span class="nav-number">1.23.5.3.</span> <span class="nav-text">3. 基于端口号80 443 8080比较合理  (测试:6111 6222)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-6-%E6%9E%84%E5%BB%BA%E5%9F%BA%E4%BA%8EHTTP%E7%9A%84%E7%BD%91%E7%BB%9CYUM%E6%BA%90"><span class="nav-number">1.23.6.</span> <span class="nav-text">22.6 构建基于HTTP的网络YUM源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E7%9B%AE%E5%BD%95"><span class="nav-number">1.23.7.</span> <span class="nav-text">返回目录</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="anyue967"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">anyue967</p>
  <div class="site-description" itemprop="description">Just for one truth</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/anyue967" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;anyue967" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:anyue1993@gmail.com" title="E-Mail → mailto:anyue1993@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/LanTian123LvXing" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;LanTian123LvXing" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://youtube.com/anyue1993" title="YouTube → https:&#x2F;&#x2F;youtube.com&#x2F;anyue1993" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="/www.shouce.ren" title="www.shouce.ren">手册网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://developer.mozilla.org/zh-CN/" title="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">MDN</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.runoob.com/" title="https:&#x2F;&#x2F;www.runoob.com&#x2F;" rel="noopener" target="_blank">菜鸟教程</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">陕ICP备2021012834号-1 </a>
      <img src="/images/beian.png" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">anyue967</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">351k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:19</span>
</div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>  Sometimes your whole life boils down to one insame move.
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("10/07/2019 00:00:00");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">

      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客数量">
        总访客数 <span id="busuanzi_value_site_uv"></span> 位
      </span>

    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">

      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>

      <span class="site-pv" title="总浏览量">
        总访问量 <span id="busuanzi_value_site_pv"></span> 次
      </span>

    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : false,
      appId      : 'Mqd39JYqUockAEjgF1Fp9Qi0-gzGzoHsz',
      appKey     : 'LPEU8VOLENFf0MYKiw2OOQgy',
      placeholder: "留点什么吧~~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>


  <script id="__bs_script__">//<![CDATA[
    document.write("<script async src='http://HOST:3000/browser-sync/browser-sync-client.js?v=2.26.12'><\/script>".replace("HOST", location.hostname));/]]>
  </script>

  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/love.js"></script>
  <!-- 崩溃页面 -->
  <script type="text/javascript" src="/js/collapse.js"></script>
</body>
</html>
